{\rtf1\ansi\ansicpg1252\cocoartf2580
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\fnil\fcharset0 Menlo-Regular;\f1\fnil\fcharset0 Menlo-Bold;}
{\colortbl;\red255\green255\blue255;\red131\green134\blue144;\red255\green255\blue255;\red16\green18\blue26;
\red31\green69\blue255;\red0\green0\blue0;\red46\green126\blue46;\red34\green157\blue130;\red190\green20\blue31;
\red32\green34\blue43;\red240\green106\blue20;\red122\green0\blue154;\red11\green31\blue135;}
{\*\expandedcolortbl;;\cssrgb\c58431\c59608\c63137;\cssrgb\c100000\c100000\c100000;\cssrgb\c7451\c9020\c13333;
\cssrgb\c16078\c38431\c100000;\cssrgb\c0\c0\c0;\cssrgb\c21961\c55686\c23529;\cssrgb\c13333\c67059\c58039;\cssrgb\c80000\c16078\c16078;
\cssrgb\c16471\c18039\c22353;\cssrgb\c96078\c49804\c9020;\cssrgb\c55686\c14118\c66667;\cssrgb\c4706\c19608\c60000;}
\paperw11900\paperh16840\margl1440\margr1440\vieww28600\viewh17440\viewkind0
\deftab720
\pard\pardeftab720\sl360\partightenfactor0

\f0\fs26 \cf2 \cb3 \expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 // This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // \'a9jdehorty\cf4 \cb1 \strokec4 \
\
\cf2 \cb3 \strokec2 // 
\f1\b @version=5
\f0\b0 \cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf5 \cb3 \strokec5 indicator\cf6 \strokec6 (\cf7 \strokec7 'Machine Learning: Lorentzian Classification'\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 'Lorentzian Classification'\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 true\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 precision\cf8 \strokec8 =\cf11 \strokec11 4\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 max_labels_count\cf8 \strokec8 =\cf11 \strokec11 500\cf6 \strokec6 )\cf4 \strokec4  \cb1 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf8 \cb3 \strokec8 import\cf4 \strokec4  \cf5 \strokec5 jdehorty/MLExtensions/2\cf4 \strokec4  \cf8 \strokec8 as\cf4 \strokec4  \cf12 \strokec12 ml\cf4 \cb1 \strokec4 \
\cf8 \cb3 \strokec8 import\cf4 \strokec4  \cf5 \strokec5 jdehorty/KernelFunctions/2\cf4 \strokec4  \cf8 \strokec8 as\cf4 \strokec4  \cf12 \strokec12 kernels\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf2 \cb3 \strokec2 // ====================\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // ==== Background ====\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // ====================\cf4 \cb1 \strokec4 \
\
\cf2 \cb3 \strokec2 // When using Machine Learning algorithms like K-Nearest Neighbors, choosing an\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // appropriate distance metric is essential. Euclidean Distance is often used as\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // the default distance metric, but it may not always be the best choice. This is\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // because market data is often significantly impacted by proximity to significant\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // world events such as FOMC Meetings and Black Swan events. These major economic\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // events can contribute to a warping effect analogous a massive object's \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // gravitational warping of Space-Time. In financial markets, this warping effect \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // operates on a continuum, which can analogously be referred to as "Price-Time".\cf4 \cb1 \strokec4 \
\
\cf2 \cb3 \strokec2 // To help to better account for this warping effect, Lorentzian Distance can be\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // used as an alternative distance metric to Euclidean Distance. The geometry of\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // Lorentzian Space can be difficult to visualize at first, and one of the best\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // ways to intuitively understand it is through an example involving 2 feature\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // dimensions (z=2). For purposes of this example, let's assume these two features\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // are Relative Strength Index (RSI) and the Average Directional Index (ADX). In\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // reality, the optimal number of features is in the range of 3-8, but for the sake\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // of simplicity, we will use only 2 features in this example.\cf4 \cb1 \strokec4 \
\
\cf2 \cb3 \strokec2 // Fundamental Assumptions:\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // (1) We can calculate RSI and ADX for a given chart.\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // (2) For simplicity, values for RSI and ADX are assumed to adhere to a Gaussian \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //     distribution in the range of 0 to 100.\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // (3) The most recent RSI and ADX value can be considered the origin of a coordinate \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //     system with ADX on the x-axis and RSI on the y-axis.\cf4 \cb1 \strokec4 \
\
\cf2 \cb3 \strokec2 // Distances in Euclidean Space:\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // Measuring the Euclidean Distances of historical values with the most recent point\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // at the origin will yield a distribution that resembles Figure 1 (below).\cf4 \cb1 \strokec4 \
\
\cf2 \cb3 \strokec2 //                        [RSI]\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //                          |                      \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //                          |                   \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //                          |                 \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //                      ...:::....              \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //                .:.:::\'95\'95\'95\'95\'95\'95:::\'95::..             \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //              .:\'95:.:\'95\'95\'95::::\'95\'95::\'95\'95....::.            \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //             ....:\'95\'95\'95\'95:\'95\'95\'95\'95\'95\'95\'95\'95::\'95\'95:...:\'95.          \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //            ...:.::::::\'95\'95\'95:::\'95\'95\'95:\'95\'95\'95::.:\'95..          \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //            ::\'95:.:\'95:\'95\'95\'95\'95\'95\'95\'95:.:\'95::::::...:..         \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //  |--------.:\'95\'95\'95..\'95\'95\'95\'95\'95\'95\'95:\'95\'95:...:::\'95:\'95:..:..----------[ADX]    \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //  0        :\'95:....:\'95\'95\'95\'95\'95::.:::\'95\'95\'95::\'95\'95:.....            \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //           ::....:.:\'95\'95\'95\'95\'95\'95\'95\'95:\'95\'95\'95::\'95\'95::..:.          \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //            .:...:\'95\'95:::\'95\'95\'95\'95\'95\'95\'95\'95::\'95\'95\'95....:          \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //              ::....:.....:\'95::\'95\'95\'95:::::..             \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //                ..:..::\'95\'95..::::..:\'95:..              \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //                    .::..:::.....:                \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //                          |            \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //                          |                   \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //                          |\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //                          |\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //                         _|_ 0        \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //                          \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //        Figure 1: Neighborhood in Euclidean Space\cf4 \cb1 \strokec4 \
\
\cf2 \cb3 \strokec2 // Distances in Lorentzian Space:\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // However, the same set of historical values measured using Lorentzian Distance will \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // yield a different distribution that resembles Figure 2 (below).\cf4 \cb1 \strokec4 \
\
\cf2 \cb3 \strokec2 //                         \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //                         [RSI] \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //  ::..                     |                    ..:::  \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //   .....                   |                  ......\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //    .\'95\'95\'95\'95::.               |               :\'95\'95\'95\'95\'95\'95. \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //     .:\'95\'95\'95\'95\'95:.             |            :::\'95\'95\'95\'95\'95\'95.  \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //       .\'95\'95\'95\'95\'95:...          |         .::.\'95\'95\'95\'95\'95\'95.    \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //         .::\'95\'95\'95\'95\'95::..      |       :..\'95\'95\'95\'95\'95\'95..      \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //            .:\'95\'95\'95\'95\'95\'95\'95::.........::\'95\'95\'95\'95\'95\'95:..         \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //              ..::::\'95\'95\'95\'95.\'95\'95\'95\'95\'95\'95\'95.\'95\'95\'95\'95\'95\'95\'95:.            \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //                ...:\'95\'95\'95\'95\'95\'95\'95.\'95\'95\'95\'95\'95\'95\'95\'95\'95::.              \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //                  .:..\'95\'95.\'95\'95\'95\'95\'95\'95.\'95\'95\'95\'95..                \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //  |---------------.:\'95\'95\'95\'95\'95\'95\'95\'95\'95\'95\'95\'95\'95\'95\'95\'95\'95.---------------[ADX]          \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //  0             .:\'95:\'95\'95\'95.\'95\'95\'95\'95\'95\'95.\'95\'95\'95\'95\'95\'95\'95.                \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //              .\'95\'95\'95\'95\'95\'95\'95\'95\'95\'95\'95\'95\'95\'95\'95\'95\'95\'95\'95\'95\'95\'95\'95\'95:.            \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //            .:\'95\'95\'95\'95\'95\'95\'95\'95\'95\'95::..::.::\'95\'95\'95\'95\'95\'95\'95\'95:.          \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //          .::\'95\'95\'95\'95\'95\'95::.     |       .::\'95\'95\'95:::.       \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //         .:\'95\'95\'95\'95\'95\'95..        |          :\'95\'95\'95\'95\'95\'95\'95\'95.     \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //       .:\'95\'95\'95\'95:...          |           ..\'95\'95\'95\'95\'95\'95\'95:.   \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //     ..:\'95\'95::..             |              :.\'95\'95\'95\'95\'95\'95\'95.   \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //    .:\'95....                |               ...::.:\'95\'95.  \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //   ...:..                  |                   :...:\'95\'95.     \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //  :::.                     |                       ..::  \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //                          _|_ 0\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //       Figure 2: Neighborhood in Lorentzian Space \cf4 \cb1 \strokec4 \
\
\
\cf2 \cb3 \strokec2 // Observations:\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // (1) In Lorentzian Space, the shortest distance between two points is not \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //     necessarily a straight line, but rather, a geodesic curve.\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // (2) The warping effect of Lorentzian distance reduces the overall influence  \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //     of outliers and noise.\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // (3) Lorentzian Distance becomes increasingly different from Euclidean Distance \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //     as the number of nearest neighbors used for comparison increases.\cf4 \cb1 \strokec4 \
\
\cf2 \cb3 \strokec2 // ======================\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // ==== Custom Types ====\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // ======================\cf4 \cb1 \strokec4 \
\
\cf2 \cb3 \strokec2 // This section uses PineScript's new Type syntax to define important data structures\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // used throughout the script.\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf8 \cb3 \strokec8 type\cf4 \strokec4  
\f1\b \cf8 \strokec8 Settings
\f0\b0 \cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf4 \cb3     
\f1\b \cf8 \strokec8 float
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 source\cf4 \cb1 \strokec4 \
\cb3     
\f1\b \cf8 \strokec8 int
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 neighborsCount\cf4 \cb1 \strokec4 \
\cb3     
\f1\b \cf8 \strokec8 int
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 maxBarsBack\cf4 \cb1 \strokec4 \
\cb3     
\f1\b \cf8 \strokec8 int
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 featureCount\cf4 \cb1 \strokec4 \
\cb3     
\f1\b \cf8 \strokec8 int
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 colorCompression\cf4 \cb1 \strokec4 \
\cb3     
\f1\b \cf8 \strokec8 bool
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 showExits\cf4 \cb1 \strokec4 \
\cb3     
\f1\b \cf8 \strokec8 bool
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 useDynamicExits\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf8 \cb3 \strokec8 type\cf4 \strokec4  
\f1\b \cf8 \strokec8 Label
\f0\b0 \cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf4 \cb3     
\f1\b \cf8 \strokec8 int
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 long\cf4 \cb1 \strokec4 \
\cb3     
\f1\b \cf8 \strokec8 int
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 short\cf4 \cb1 \strokec4 \
\cb3     
\f1\b \cf8 \strokec8 int
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 neutral\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf8 \cb3 \strokec8 type\cf4 \strokec4  
\f1\b \cf8 \strokec8 FeatureArrays
\f0\b0 \cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf4 \cb3     
\f1\b \cf8 \strokec8 array
\f0\b0 \cf6 \strokec6 <
\f1\b \cf8 \strokec8 float
\f0\b0 \cf6 \strokec6 >\cf4 \strokec4  \cf10 \strokec10 f1\cf4 \cb1 \strokec4 \
\cb3     
\f1\b \cf8 \strokec8 array
\f0\b0 \cf6 \strokec6 <
\f1\b \cf8 \strokec8 float
\f0\b0 \cf6 \strokec6 >\cf4 \strokec4  \cf10 \strokec10 f2\cf4 \cb1 \strokec4 \
\cb3     
\f1\b \cf8 \strokec8 array
\f0\b0 \cf6 \strokec6 <
\f1\b \cf8 \strokec8 float
\f0\b0 \cf6 \strokec6 >\cf4 \strokec4  \cf10 \strokec10 f3\cf4 \cb1 \strokec4 \
\cb3     
\f1\b \cf8 \strokec8 array
\f0\b0 \cf6 \strokec6 <
\f1\b \cf8 \strokec8 float
\f0\b0 \cf6 \strokec6 >\cf4 \strokec4  \cf10 \strokec10 f4\cf4 \cb1 \strokec4 \
\cb3     
\f1\b \cf8 \strokec8 array
\f0\b0 \cf6 \strokec6 <
\f1\b \cf8 \strokec8 float
\f0\b0 \cf6 \strokec6 >\cf4 \strokec4  \cf10 \strokec10 f5\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf8 \cb3 \strokec8 type\cf4 \strokec4  
\f1\b \cf8 \strokec8 FeatureSeries
\f0\b0 \cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf4 \cb3     
\f1\b \cf8 \strokec8 float
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 f1\cf4 \cb1 \strokec4 \
\cb3     
\f1\b \cf8 \strokec8 float
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 f2\cf4 \cb1 \strokec4 \
\cb3     
\f1\b \cf8 \strokec8 float
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 f3\cf4 \cb1 \strokec4 \
\cb3     
\f1\b \cf8 \strokec8 float
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 f4\cf4 \cb1 \strokec4 \
\cb3     
\f1\b \cf8 \strokec8 float
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 f5\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf8 \cb3 \strokec8 type\cf4 \strokec4  
\f1\b \cf8 \strokec8 MLModel
\f0\b0 \cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf4 \cb3     
\f1\b \cf8 \strokec8 int
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 firstBarIndex\cf4 \cb1 \strokec4 \
\cb3     
\f1\b \cf8 \strokec8 array
\f0\b0 \cf6 \strokec6 <
\f1\b \cf8 \strokec8 int
\f0\b0 \cf6 \strokec6 >\cf4 \strokec4  \cf10 \strokec10 trainingLabels\cf4 \cb1 \strokec4 \
\cb3     
\f1\b \cf8 \strokec8 int
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 loopSize\cf4 \cb1 \strokec4 \
\cb3     
\f1\b \cf8 \strokec8 float
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 lastDistance\cf4 \cb1 \strokec4 \
\cb3     
\f1\b \cf8 \strokec8 array
\f0\b0 \cf6 \strokec6 <
\f1\b \cf8 \strokec8 float
\f0\b0 \cf6 \strokec6 >\cf4 \strokec4  \cf10 \strokec10 distancesArray\cf4 \cb1 \strokec4 \
\cb3     
\f1\b \cf8 \strokec8 array
\f0\b0 \cf6 \strokec6 <
\f1\b \cf8 \strokec8 int
\f0\b0 \cf6 \strokec6 >\cf4 \strokec4  \cf10 \strokec10 predictionsArray\cf4 \cb1 \strokec4 \
\cb3     
\f1\b \cf8 \strokec8 int
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 prediction\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf8 \cb3 \strokec8 type\cf4 \strokec4  FilterSettings \cb1 \
\pard\pardeftab720\sl360\partightenfactor0
\cf4 \cb3     
\f1\b \cf8 \strokec8 bool
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 useVolatilityFilter\cf4 \cb1 \strokec4 \
\cb3     
\f1\b \cf8 \strokec8 bool
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 useRegimeFilter\cf4 \cb1 \strokec4 \
\cb3     
\f1\b \cf8 \strokec8 bool
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 useAdxFilter\cf4 \cb1 \strokec4 \
\cb3     
\f1\b \cf8 \strokec8 float
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 regimeThreshold\cf4 \cb1 \strokec4 \
\cb3     
\f1\b \cf8 \strokec8 int
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 adxThreshold\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf8 \cb3 \strokec8 type\cf4 \strokec4  
\f1\b \cf8 \strokec8 Filter
\f0\b0 \cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf4 \cb3     
\f1\b \cf8 \strokec8 bool
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 volatility\cf4 \cb1 \strokec4 \
\cb3     
\f1\b \cf8 \strokec8 bool
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 regime\cf4 \cb1 \strokec4 \
\cb3     
\f1\b \cf8 \strokec8 bool
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 adx\cf4 \strokec4  \cb1 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf2 \cb3 \strokec2 // ==========================\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // ==== Helper Functions ====\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // ==========================\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf13 \cb3 \strokec13 series_from\cf6 \strokec6 (\cf10 \strokec10 feature_string\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 _close\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 _high\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 _low\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 _hlc3\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 f_paramA\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 f_paramB\cf6 \strokec6 )\cf4 \strokec4  \cf8 \strokec8 =>\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf4 \cb3     
\f1\b \cf8 \strokec8 switch
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 feature_string\cf4 \cb1 \strokec4 \
\cb3         \cf7 \strokec7 "RSI"\cf4 \strokec4  \cf8 \strokec8 =>\cf4 \strokec4  \cf12 \strokec12 ml.n_rsi\cf6 \strokec6 (\cf10 \strokec10 _close\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 f_paramA\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 f_paramB\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cb3         \cf7 \strokec7 "WT"\cf4 \strokec4  \cf8 \strokec8 =>\cf4 \strokec4  \cf12 \strokec12 ml.n_wt\cf6 \strokec6 (\cf10 \strokec10 _hlc3\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 f_paramA\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 f_paramB\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cb3         \cf7 \strokec7 "CCI"\cf4 \strokec4  \cf8 \strokec8 =>\cf4 \strokec4  \cf12 \strokec12 ml.n_cci\cf6 \strokec6 (\cf10 \strokec10 _close\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 f_paramA\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 f_paramB\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cb3         \cf7 \strokec7 "ADX"\cf4 \strokec4  \cf8 \strokec8 =>\cf4 \strokec4  \cf12 \strokec12 ml.n_adx\cf6 \strokec6 (\cf10 \strokec10 _high\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 _low\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 _close\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 f_paramA\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf13 \cb3 \strokec13 get_lorentzian_distance\cf6 \strokec6 (
\f1\b \cf8 \strokec8 int
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 i\cf8 \strokec8 ,\cf4 \strokec4  
\f1\b \cf8 \strokec8 int
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 featureCount\cf8 \strokec8 ,\cf4 \strokec4  
\f1\b \cf8 \strokec8 FeatureSeries
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 featureSeries\cf8 \strokec8 ,\cf4 \strokec4  
\f1\b \cf8 \strokec8 FeatureArrays
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 featureArrays\cf6 \strokec6 )\cf4 \strokec4  \cf8 \strokec8 =>\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf4 \cb3     
\f1\b \cf8 \strokec8 switch
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 featureCount\cf4 \cb1 \strokec4 \
\cb3         \cf11 \strokec11 5\cf4 \strokec4  \cf8 \strokec8 =>\cf4 \strokec4  \cf5 \strokec5 math.log\cf6 \strokec6 (\cf11 \strokec11 1\cf8 \strokec8 +\cf5 \strokec5 math.abs\cf6 \strokec6 (\cf10 \strokec10 featureSeries\cf4 \strokec4 .\cf10 \strokec10 f1\cf4 \strokec4  \cf8 \strokec8 -\cf4 \strokec4  \cf5 \strokec5 array.get\cf6 \strokec6 (\cf10 \strokec10 featureArrays\cf4 \strokec4 .\cf10 \strokec10 f1\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 i\cf6 \strokec6 )))\cf4 \strokec4  \cf8 \strokec8 +\cf4 \strokec4  \cb1 \
\cb3              \cf5 \strokec5 math.log\cf6 \strokec6 (\cf11 \strokec11 1\cf8 \strokec8 +\cf5 \strokec5 math.abs\cf6 \strokec6 (\cf10 \strokec10 featureSeries\cf4 \strokec4 .\cf10 \strokec10 f2\cf4 \strokec4  \cf8 \strokec8 -\cf4 \strokec4  \cf5 \strokec5 array.get\cf6 \strokec6 (\cf10 \strokec10 featureArrays\cf4 \strokec4 .\cf10 \strokec10 f2\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 i\cf6 \strokec6 )))\cf4 \strokec4  \cf8 \strokec8 +\cf4 \strokec4  \cb1 \
\cb3              \cf5 \strokec5 math.log\cf6 \strokec6 (\cf11 \strokec11 1\cf8 \strokec8 +\cf5 \strokec5 math.abs\cf6 \strokec6 (\cf10 \strokec10 featureSeries\cf4 \strokec4 .\cf10 \strokec10 f3\cf4 \strokec4  \cf8 \strokec8 -\cf4 \strokec4  \cf5 \strokec5 array.get\cf6 \strokec6 (\cf10 \strokec10 featureArrays\cf4 \strokec4 .\cf10 \strokec10 f3\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 i\cf6 \strokec6 )))\cf4 \strokec4  \cf8 \strokec8 +\cf4 \strokec4  \cb1 \
\cb3              \cf5 \strokec5 math.log\cf6 \strokec6 (\cf11 \strokec11 1\cf8 \strokec8 +\cf5 \strokec5 math.abs\cf6 \strokec6 (\cf10 \strokec10 featureSeries\cf4 \strokec4 .\cf10 \strokec10 f4\cf4 \strokec4  \cf8 \strokec8 -\cf4 \strokec4  \cf5 \strokec5 array.get\cf6 \strokec6 (\cf10 \strokec10 featureArrays\cf4 \strokec4 .\cf10 \strokec10 f4\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 i\cf6 \strokec6 )))\cf4 \strokec4  \cf8 \strokec8 +\cf4 \strokec4  \cb1 \
\cb3              \cf5 \strokec5 math.log\cf6 \strokec6 (\cf11 \strokec11 1\cf8 \strokec8 +\cf5 \strokec5 math.abs\cf6 \strokec6 (\cf10 \strokec10 featureSeries\cf4 \strokec4 .\cf10 \strokec10 f5\cf4 \strokec4  \cf8 \strokec8 -\cf4 \strokec4  \cf5 \strokec5 array.get\cf6 \strokec6 (\cf10 \strokec10 featureArrays\cf4 \strokec4 .\cf10 \strokec10 f5\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 i\cf6 \strokec6 )))\cf4 \cb1 \strokec4 \
\cb3         \cf11 \strokec11 4\cf4 \strokec4  \cf8 \strokec8 =>\cf4 \strokec4  \cf5 \strokec5 math.log\cf6 \strokec6 (\cf11 \strokec11 1\cf8 \strokec8 +\cf5 \strokec5 math.abs\cf6 \strokec6 (\cf10 \strokec10 featureSeries\cf4 \strokec4 .\cf10 \strokec10 f1\cf4 \strokec4  \cf8 \strokec8 -\cf4 \strokec4  \cf5 \strokec5 array.get\cf6 \strokec6 (\cf10 \strokec10 featureArrays\cf4 \strokec4 .\cf10 \strokec10 f1\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 i\cf6 \strokec6 )))\cf4 \strokec4  \cf8 \strokec8 +\cf4 \cb1 \strokec4 \
\cb3              \cf5 \strokec5 math.log\cf6 \strokec6 (\cf11 \strokec11 1\cf8 \strokec8 +\cf5 \strokec5 math.abs\cf6 \strokec6 (\cf10 \strokec10 featureSeries\cf4 \strokec4 .\cf10 \strokec10 f2\cf4 \strokec4  \cf8 \strokec8 -\cf4 \strokec4  \cf5 \strokec5 array.get\cf6 \strokec6 (\cf10 \strokec10 featureArrays\cf4 \strokec4 .\cf10 \strokec10 f2\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 i\cf6 \strokec6 )))\cf4 \strokec4  \cf8 \strokec8 +\cf4 \cb1 \strokec4 \
\cb3              \cf5 \strokec5 math.log\cf6 \strokec6 (\cf11 \strokec11 1\cf8 \strokec8 +\cf5 \strokec5 math.abs\cf6 \strokec6 (\cf10 \strokec10 featureSeries\cf4 \strokec4 .\cf10 \strokec10 f3\cf4 \strokec4  \cf8 \strokec8 -\cf4 \strokec4  \cf5 \strokec5 array.get\cf6 \strokec6 (\cf10 \strokec10 featureArrays\cf4 \strokec4 .\cf10 \strokec10 f3\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 i\cf6 \strokec6 )))\cf4 \strokec4  \cf8 \strokec8 +\cf4 \cb1 \strokec4 \
\cb3              \cf5 \strokec5 math.log\cf6 \strokec6 (\cf11 \strokec11 1\cf8 \strokec8 +\cf5 \strokec5 math.abs\cf6 \strokec6 (\cf10 \strokec10 featureSeries\cf4 \strokec4 .\cf10 \strokec10 f4\cf4 \strokec4  \cf8 \strokec8 -\cf4 \strokec4  \cf5 \strokec5 array.get\cf6 \strokec6 (\cf10 \strokec10 featureArrays\cf4 \strokec4 .\cf10 \strokec10 f4\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 i\cf6 \strokec6 )))\cf4 \cb1 \strokec4 \
\cb3         \cf11 \strokec11 3\cf4 \strokec4  \cf8 \strokec8 =>\cf4 \strokec4  \cf5 \strokec5 math.log\cf6 \strokec6 (\cf11 \strokec11 1\cf8 \strokec8 +\cf5 \strokec5 math.abs\cf6 \strokec6 (\cf10 \strokec10 featureSeries\cf4 \strokec4 .\cf10 \strokec10 f1\cf4 \strokec4  \cf8 \strokec8 -\cf4 \strokec4  \cf5 \strokec5 array.get\cf6 \strokec6 (\cf10 \strokec10 featureArrays\cf4 \strokec4 .\cf10 \strokec10 f1\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 i\cf6 \strokec6 )))\cf4 \strokec4  \cf8 \strokec8 +\cf4 \cb1 \strokec4 \
\cb3              \cf5 \strokec5 math.log\cf6 \strokec6 (\cf11 \strokec11 1\cf8 \strokec8 +\cf5 \strokec5 math.abs\cf6 \strokec6 (\cf10 \strokec10 featureSeries\cf4 \strokec4 .\cf10 \strokec10 f2\cf4 \strokec4  \cf8 \strokec8 -\cf4 \strokec4  \cf5 \strokec5 array.get\cf6 \strokec6 (\cf10 \strokec10 featureArrays\cf4 \strokec4 .\cf10 \strokec10 f2\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 i\cf6 \strokec6 )))\cf4 \strokec4  \cf8 \strokec8 +\cf4 \cb1 \strokec4 \
\cb3              \cf5 \strokec5 math.log\cf6 \strokec6 (\cf11 \strokec11 1\cf8 \strokec8 +\cf5 \strokec5 math.abs\cf6 \strokec6 (\cf10 \strokec10 featureSeries\cf4 \strokec4 .\cf10 \strokec10 f3\cf4 \strokec4  \cf8 \strokec8 -\cf4 \strokec4  \cf5 \strokec5 array.get\cf6 \strokec6 (\cf10 \strokec10 featureArrays\cf4 \strokec4 .\cf10 \strokec10 f3\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 i\cf6 \strokec6 )))\cf4 \cb1 \strokec4 \
\cb3         \cf11 \strokec11 2\cf4 \strokec4  \cf8 \strokec8 =>\cf4 \strokec4  \cf5 \strokec5 math.log\cf6 \strokec6 (\cf11 \strokec11 1\cf8 \strokec8 +\cf5 \strokec5 math.abs\cf6 \strokec6 (\cf10 \strokec10 featureSeries\cf4 \strokec4 .\cf10 \strokec10 f1\cf4 \strokec4  \cf8 \strokec8 -\cf4 \strokec4  \cf5 \strokec5 array.get\cf6 \strokec6 (\cf10 \strokec10 featureArrays\cf4 \strokec4 .\cf10 \strokec10 f1\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 i\cf6 \strokec6 )))\cf4 \strokec4  \cf8 \strokec8 +\cf4 \cb1 \strokec4 \
\cb3              \cf5 \strokec5 math.log\cf6 \strokec6 (\cf11 \strokec11 1\cf8 \strokec8 +\cf5 \strokec5 math.abs\cf6 \strokec6 (\cf10 \strokec10 featureSeries\cf4 \strokec4 .\cf10 \strokec10 f2\cf4 \strokec4  \cf8 \strokec8 -\cf4 \strokec4  \cf5 \strokec5 array.get\cf6 \strokec6 (\cf10 \strokec10 featureArrays\cf4 \strokec4 .\cf10 \strokec10 f2\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 i\cf6 \strokec6 )))\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf2 \cb3 \strokec2 // ================  \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // ==== Inputs ==== \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // ================ \cf4 \cb1 \strokec4 \
\
\cf2 \cb3 \strokec2 // Settings Object: General User-Defined Inputs\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0

\f1\b \cf8 \cb3 \strokec8 Settings
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 settings\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cb1 \
\pard\pardeftab720\sl360\partightenfactor0
\cf4 \cb3  \cf13 \strokec13 Settings.new\cf6 \strokec6 (\cf4 \cb1 \strokec4 \
\cb3    \cf5 \strokec5 input.source\cf6 \strokec6 (\cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 'Source'\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 defval\cf8 \strokec8 =\cf9 \strokec9 close\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "General Settings"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tooltip\cf8 \strokec8 =\cf7 \strokec7 "Source of the input data"\cf6 \strokec6 )\cf8 \strokec8 ,\cf4 \cb1 \strokec4 \
\cb3    \cf5 \strokec5 input.int\cf6 \strokec6 (\cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 'Neighbors Count'\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 defval\cf8 \strokec8 =\cf11 \strokec11 8\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "General Settings"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 minval\cf8 \strokec8 =\cf11 \strokec11 1\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 maxval\cf8 \strokec8 =\cf11 \strokec11 100\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 step\cf8 \strokec8 =\cf11 \strokec11 1\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tooltip\cf8 \strokec8 =\cf7 \strokec7 "Number of neighbors to consider"\cf6 \strokec6 )\cf8 \strokec8 ,\cf4 \cb1 \strokec4 \
\cb3    \cf5 \strokec5 input.int\cf6 \strokec6 (\cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 "Max Bars Back"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 defval\cf8 \strokec8 =\cf11 \strokec11 2000\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "General Settings"\cf6 \strokec6 )\cf8 \strokec8 ,\cf4 \cb1 \strokec4 \
\cb3    \cf5 \strokec5 input.int\cf6 \strokec6 (\cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 "Feature Count"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 defval\cf8 \strokec8 =\cf11 \strokec11 5\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "Feature Engineering"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 minval\cf8 \strokec8 =\cf11 \strokec11 2\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 maxval\cf8 \strokec8 =\cf11 \strokec11 5\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tooltip\cf8 \strokec8 =\cf7 \strokec7 "Number of features to use for ML predictions."\cf6 \strokec6 )\cf8 \strokec8 ,\cf4 \cb1 \strokec4 \
\cb3    \cf5 \strokec5 input.int\cf6 \strokec6 (\cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 "Color Compression"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 defval\cf8 \strokec8 =\cf11 \strokec11 1\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "General Settings"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 minval\cf8 \strokec8 =\cf11 \strokec11 1\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 maxval\cf8 \strokec8 =\cf11 \strokec11 10\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tooltip\cf8 \strokec8 =\cf7 \strokec7 "Compression factor for adjusting the intensity of the color scale."\cf6 \strokec6 )\cf8 \strokec8 ,\cf4 \cb1 \strokec4 \
\cb3    \cf5 \strokec5 input.bool\cf6 \strokec6 (\cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 "Show Default Exits"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 defval\cf8 \strokec8 =\cf9 \strokec9 false\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "General Settings"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tooltip\cf8 \strokec8 =\cf7 \strokec7 "Default exits occur exactly 4 bars after an entry signal. This corresponds to the predefined length of a trade during the model's training process."\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 inline\cf8 \strokec8 =\cf7 \strokec7 "exits"\cf6 \strokec6 )\cf8 \strokec8 ,\cf4 \cb1 \strokec4 \
\cb3    \cf5 \strokec5 input.bool\cf6 \strokec6 (\cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 "Use Dynamic Exits"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 defval\cf8 \strokec8 =\cf9 \strokec9 false\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "General Settings"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tooltip\cf8 \strokec8 =\cf7 \strokec7 "Dynamic exits attempt to let profits ride by dynamically adjusting the exit threshold based on kernel regression logic."\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 inline\cf8 \strokec8 =\cf7 \strokec7 "exits"\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cb3  \cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cb3    \cb1 \
\pard\pardeftab720\sl360\partightenfactor0
\cf2 \cb3 \strokec2 // Trade Stats Settings\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // Note: The trade stats section is NOT intended to be used as a replacement for proper backtesting. It is intended to be used for calibration purposes only.\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf10 \cb3 \strokec10 showTradeStats\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 input.bool\cf6 \strokec6 (\cf9 \strokec9 true\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 'Show Trade Stats'\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tooltip\cf8 \strokec8 =\cf7 \strokec7 'Displays the trade stats for a given configuration. Useful for optimizing the settings in the Feature Engineering section. This should NOT replace backtesting and should be used for calibration purposes only. Early Signal Flips represent instances where the model changes signals before 4 bars elapses; high values can indicate choppy (ranging) market conditions.'\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "General Settings"\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 useWorstCase\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 input.bool\cf6 \strokec6 (\cf9 \strokec9 false\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 "Use Worst Case Estimates"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tooltip\cf8 \strokec8 =\cf7 \strokec7 "Whether to use the worst case scenario for backtesting. This option can be useful for creating a conservative estimate that is based on close prices only, thus avoiding the effects of intrabar repainting. This option assumes that the user does not enter when the signal first appears and instead waits for the bar to close as confirmation. On larger timeframes, this can mean entering after a large move has already occurred. Leaving this option disabled is generally better for those that use this indicator as a source of confluence and prefer estimates that demonstrate discretionary mid-bar entries. Leaving this option enabled may be more consistent with traditional backtesting results."\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "General Settings"\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf2 \cb3 \strokec2 // Settings object for user-defined settings\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0

\f1\b \cf8 \cb3 \strokec8 FilterSettings
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 filterSettings\cf4 \strokec4  \cf8 \strokec8 =\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf4 \cb3  \cf13 \strokec13 FilterSettings.new\cf6 \strokec6 (\cf4 \cb1 \strokec4 \
\cb3    \cf5 \strokec5 input.bool\cf6 \strokec6 (\cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 "Use Volatility Filter"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 defval\cf8 \strokec8 =\cf9 \strokec9 true\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tooltip\cf8 \strokec8 =\cf7 \strokec7 "Whether to use the volatility filter."\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "Filters"\cf6 \strokec6 )\cf8 \strokec8 ,\cf4 \cb1 \strokec4 \
\cb3    \cf5 \strokec5 input.bool\cf6 \strokec6 (\cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 "Use Regime Filter"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 defval\cf8 \strokec8 =\cf9 \strokec9 true\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "Filters"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 inline\cf8 \strokec8 =\cf7 \strokec7 "regime"\cf6 \strokec6 )\cf8 \strokec8 ,\cf4 \cb1 \strokec4 \
\cb3    \cf5 \strokec5 input.bool\cf6 \strokec6 (\cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 "Use ADX Filter"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 defval\cf8 \strokec8 =\cf9 \strokec9 false\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "Filters"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 inline\cf8 \strokec8 =\cf7 \strokec7 "adx"\cf6 \strokec6 )\cf8 \strokec8 ,\cf4 \cb1 \strokec4 \
\cb3    \cf5 \strokec5 input.float\cf6 \strokec6 (\cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 "Threshold"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 defval\cf8 \strokec8 =\cf11 \strokec11 -0.1\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 minval\cf8 \strokec8 =\cf11 \strokec11 -10\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 maxval\cf8 \strokec8 =\cf11 \strokec11 10\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 step\cf8 \strokec8 =\cf11 \strokec11 0.1\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tooltip\cf8 \strokec8 =\cf7 \strokec7 "Whether to use the trend detection filter. Threshold for detecting Trending/Ranging markets."\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "Filters"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 inline\cf8 \strokec8 =\cf7 \strokec7 "regime"\cf6 \strokec6 )\cf8 \strokec8 ,\cf4 \cb1 \strokec4 \
\cb3    \cf5 \strokec5 input.int\cf6 \strokec6 (\cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 "Threshold"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 defval\cf8 \strokec8 =\cf11 \strokec11 20\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 minval\cf8 \strokec8 =\cf11 \strokec11 0\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 maxval\cf8 \strokec8 =\cf11 \strokec11 100\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 step\cf8 \strokec8 =\cf11 \strokec11 1\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tooltip\cf8 \strokec8 =\cf7 \strokec7 "Whether to use the ADX filter. Threshold for detecting Trending/Ranging markets."\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "Filters"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 inline\cf8 \strokec8 =\cf7 \strokec7 "adx"\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cb3  \cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf2 \cb3 \strokec2 // Filter object for filtering the ML predictions\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0

\f1\b \cf8 \cb3 \strokec8 Filter
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 filter\cf4 \strokec4  \cf8 \strokec8 =\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf4 \cb3  \cf13 \strokec13 Filter.new\cf6 \strokec6 (\cf4 \cb1 \strokec4 \
\cb3    \cf12 \strokec12 ml.filter_volatility\cf6 \strokec6 (\cf11 \strokec11 1\cf8 \strokec8 ,\cf4 \strokec4  \cf11 \strokec11 10\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 filterSettings\cf4 \strokec4 .\cf10 \strokec10 useVolatilityFilter\cf6 \strokec6 )\cf8 \strokec8 ,\cf4 \strokec4  \cb1 \
\cb3    \cf12 \strokec12 ml.regime_filter\cf6 \strokec6 (\cf9 \strokec9 ohlc4\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 filterSettings\cf4 \strokec4 .\cf10 \strokec10 regimeThreshold\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 filterSettings\cf4 \strokec4 .\cf10 \strokec10 useRegimeFilter\cf6 \strokec6 )\cf8 \strokec8 ,\cf4 \cb1 \strokec4 \
\cb3    \cf12 \strokec12 ml.filter_adx\cf6 \strokec6 (\cf10 \strokec10 settings\cf4 \strokec4 .\cf10 \strokec10 source\cf8 \strokec8 ,\cf4 \strokec4  \cf11 \strokec11 14\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 filterSettings\cf4 \strokec4 .\cf10 \strokec10 adxThreshold\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 filterSettings\cf4 \strokec4 .\cf10 \strokec10 useAdxFilter\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cb3   \cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf2 \cb3 \strokec2 // Feature Variables: User-Defined Inputs for calculating Feature Series. \cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf10 \cb3 \strokec10 f1_string\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 input.string\cf6 \strokec6 (\cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 "Feature 1"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 options\cf8 \strokec8 =\cf6 \strokec6 [\cf7 \strokec7 "RSI"\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 "WT"\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 "CCI"\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 "ADX"\cf6 \strokec6 ]\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 defval\cf8 \strokec8 =\cf7 \strokec7 "RSI"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 inline\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf7 \strokec7 "01"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tooltip\cf8 \strokec8 =\cf7 \strokec7 "The first feature to use for ML predictions."\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "Feature Engineering"\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 f1_paramA\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 input.int\cf6 \strokec6 (\cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 "Parameter A"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tooltip\cf8 \strokec8 =\cf7 \strokec7 "The primary parameter of feature 1."\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 defval\cf8 \strokec8 =\cf11 \strokec11 14\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 inline\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf7 \strokec7 "02"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "Feature Engineering"\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 f1_paramB\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 input.int\cf6 \strokec6 (\cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 "Parameter B"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tooltip\cf8 \strokec8 =\cf7 \strokec7 "The secondary parameter of feature 2 (if applicable)."\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 defval\cf8 \strokec8 =\cf11 \strokec11 1\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 inline\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf7 \strokec7 "02"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "Feature Engineering"\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 f2_string\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 input.string\cf6 \strokec6 (\cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 "Feature 2"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 options\cf8 \strokec8 =\cf6 \strokec6 [\cf7 \strokec7 "RSI"\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 "WT"\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 "CCI"\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 "ADX"\cf6 \strokec6 ]\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 defval\cf8 \strokec8 =\cf7 \strokec7 "WT"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 inline\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf7 \strokec7 "03"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tooltip\cf8 \strokec8 =\cf7 \strokec7 "The second feature to use for ML predictions."\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "Feature Engineering"\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 f2_paramA\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 input.int\cf6 \strokec6 (\cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 "Parameter A"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tooltip\cf8 \strokec8 =\cf7 \strokec7 "The primary parameter of feature 2."\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 defval\cf8 \strokec8 =\cf11 \strokec11 10\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 inline\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf7 \strokec7 "04"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "Feature Engineering"\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 f2_paramB\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 input.int\cf6 \strokec6 (\cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 "Parameter B"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tooltip\cf8 \strokec8 =\cf7 \strokec7 "The secondary parameter of feature 2 (if applicable)."\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 defval\cf8 \strokec8 =\cf11 \strokec11 11\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 inline\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf7 \strokec7 "04"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "Feature Engineering"\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 f3_string\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 input.string\cf6 \strokec6 (\cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 "Feature 3"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 options\cf8 \strokec8 =\cf6 \strokec6 [\cf7 \strokec7 "RSI"\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 "WT"\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 "CCI"\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 "ADX"\cf6 \strokec6 ]\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 defval\cf8 \strokec8 =\cf7 \strokec7 "CCI"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 inline\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf7 \strokec7 "05"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tooltip\cf8 \strokec8 =\cf7 \strokec7 "The third feature to use for ML predictions."\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "Feature Engineering"\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 f3_paramA\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 input.int\cf6 \strokec6 (\cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 "Parameter A"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tooltip\cf8 \strokec8 =\cf7 \strokec7 "The primary parameter of feature 3."\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 defval\cf8 \strokec8 =\cf11 \strokec11 20\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 inline\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf7 \strokec7 "06"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "Feature Engineering"\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 f3_paramB\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 input.int\cf6 \strokec6 (\cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 "Parameter B"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tooltip\cf8 \strokec8 =\cf7 \strokec7 "The secondary parameter of feature 3 (if applicable)."\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 defval\cf8 \strokec8 =\cf11 \strokec11 1\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 inline\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf7 \strokec7 "06"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "Feature Engineering"\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 f4_string\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 input.string\cf6 \strokec6 (\cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 "Feature 4"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 options\cf8 \strokec8 =\cf6 \strokec6 [\cf7 \strokec7 "RSI"\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 "WT"\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 "CCI"\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 "ADX"\cf6 \strokec6 ]\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 defval\cf8 \strokec8 =\cf7 \strokec7 "ADX"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 inline\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf7 \strokec7 "07"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tooltip\cf8 \strokec8 =\cf7 \strokec7 "The fourth feature to use for ML predictions."\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "Feature Engineering"\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 f4_paramA\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 input.int\cf6 \strokec6 (\cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 "Parameter A"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tooltip\cf8 \strokec8 =\cf7 \strokec7 "The primary parameter of feature 4."\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 defval\cf8 \strokec8 =\cf11 \strokec11 20\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 inline\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf7 \strokec7 "08"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "Feature Engineering"\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 f4_paramB\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 input.int\cf6 \strokec6 (\cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 "Parameter B"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tooltip\cf8 \strokec8 =\cf7 \strokec7 "The secondary parameter of feature 4 (if applicable)."\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 defval\cf8 \strokec8 =\cf11 \strokec11 2\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 inline\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf7 \strokec7 "08"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "Feature Engineering"\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 f5_string\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 input.string\cf6 \strokec6 (\cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 "Feature 5"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 options\cf8 \strokec8 =\cf6 \strokec6 [\cf7 \strokec7 "RSI"\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 "WT"\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 "CCI"\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 "ADX"\cf6 \strokec6 ]\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 defval\cf8 \strokec8 =\cf7 \strokec7 "RSI"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 inline\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf7 \strokec7 "09"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tooltip\cf8 \strokec8 =\cf7 \strokec7 "The fifth feature to use for ML predictions."\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "Feature Engineering"\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 f5_paramA\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 input.int\cf6 \strokec6 (\cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 "Parameter A"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tooltip\cf8 \strokec8 =\cf7 \strokec7 "The primary parameter of feature 5."\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 defval\cf8 \strokec8 =\cf11 \strokec11 9\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 inline\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf7 \strokec7 "10"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "Feature Engineering"\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 f5_paramB\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 input.int\cf6 \strokec6 (\cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 "Parameter B"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tooltip\cf8 \strokec8 =\cf7 \strokec7 "The secondary parameter of feature 5 (if applicable)."\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 defval\cf8 \strokec8 =\cf11 \strokec11 1\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 inline\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf7 \strokec7 "10"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "Feature Engineering"\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf2 \cb3 \strokec2 // FeatureSeries Object: Calculated Feature Series based on Feature Variables\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf10 \cb3 \strokec10 featureSeries\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cb1 \
\pard\pardeftab720\sl360\partightenfactor0
\cf4 \cb3  \cf13 \strokec13 FeatureSeries.new\cf6 \strokec6 (\cf4 \cb1 \strokec4 \
\cb3    \cf13 \strokec13 series_from\cf6 \strokec6 (\cf10 \strokec10 f1_string\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 close\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 high\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 low\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 hlc3\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 f1_paramA\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 f1_paramB\cf6 \strokec6 )\cf8 \strokec8 ,\cf4 \strokec4  \cf2 \strokec2 // f1\cf4 \cb1 \strokec4 \
\cb3    \cf13 \strokec13 series_from\cf6 \strokec6 (\cf10 \strokec10 f2_string\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 close\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 high\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 low\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 hlc3\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 f2_paramA\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 f2_paramB\cf6 \strokec6 )\cf8 \strokec8 ,\cf4 \strokec4  \cf2 \strokec2 // f2 \cf4 \cb1 \strokec4 \
\cb3    \cf13 \strokec13 series_from\cf6 \strokec6 (\cf10 \strokec10 f3_string\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 close\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 high\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 low\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 hlc3\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 f3_paramA\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 f3_paramB\cf6 \strokec6 )\cf8 \strokec8 ,\cf4 \strokec4  \cf2 \strokec2 // f3\cf4 \cb1 \strokec4 \
\cb3    \cf13 \strokec13 series_from\cf6 \strokec6 (\cf10 \strokec10 f4_string\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 close\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 high\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 low\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 hlc3\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 f4_paramA\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 f4_paramB\cf6 \strokec6 )\cf8 \strokec8 ,\cf4 \strokec4  \cf2 \strokec2 // f4\cf4 \cb1 \strokec4 \
\cb3    \cf13 \strokec13 series_from\cf6 \strokec6 (\cf10 \strokec10 f5_string\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 close\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 high\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 low\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 hlc3\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 f5_paramA\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 f5_paramB\cf6 \strokec6 )\cf4 \strokec4   \cf2 \strokec2 // f5\cf4 \cb1 \strokec4 \
\cb3  \cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf2 \cb3 \strokec2 // FeatureArrays Variables: Storage of Feature Series as Feature Arrays Optimized for ML\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // Note: These arrays cannot be dynamically created within the FeatureArrays Object Initialization and thus must be set-up in advance.\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf8 \cb3 \strokec8 var\cf4 \strokec4  \cf10 \strokec10 f1Array\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 array.new_float\cf6 \strokec6 ()\cf4 \cb1 \strokec4 \
\cf8 \cb3 \strokec8 var\cf4 \strokec4  \cf10 \strokec10 f2Array\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 array.new_float\cf6 \strokec6 ()\cf4 \cb1 \strokec4 \
\cf8 \cb3 \strokec8 var\cf4 \strokec4  \cf10 \strokec10 f3Array\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 array.new_float\cf6 \strokec6 ()\cf4 \cb1 \strokec4 \
\cf8 \cb3 \strokec8 var\cf4 \strokec4  \cf10 \strokec10 f4Array\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 array.new_float\cf6 \strokec6 ()\cf4 \cb1 \strokec4 \
\cf8 \cb3 \strokec8 var\cf4 \strokec4  \cf10 \strokec10 f5Array\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 array.new_float\cf6 \strokec6 ()\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf5 \cb3 \strokec5 array.push\cf6 \strokec6 (\cf10 \strokec10 f1Array\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 featureSeries\cf4 \strokec4 .\cf10 \strokec10 f1\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5 array.push\cf6 \strokec6 (\cf10 \strokec10 f2Array\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 featureSeries\cf4 \strokec4 .\cf10 \strokec10 f2\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5 array.push\cf6 \strokec6 (\cf10 \strokec10 f3Array\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 featureSeries\cf4 \strokec4 .\cf10 \strokec10 f3\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5 array.push\cf6 \strokec6 (\cf10 \strokec10 f4Array\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 featureSeries\cf4 \strokec4 .\cf10 \strokec10 f4\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5 array.push\cf6 \strokec6 (\cf10 \strokec10 f5Array\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 featureSeries\cf4 \strokec4 .\cf10 \strokec10 f5\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf2 \cb3 \strokec2 // FeatureArrays Object: Storage of the calculated FeatureArrays into a single object\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf10 \cb3 \strokec10 featureArrays\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cb1 \
\pard\pardeftab720\sl360\partightenfactor0
\cf4 \cb3  \cf13 \strokec13 FeatureArrays.new\cf6 \strokec6 (\cf4 \cb1 \strokec4 \
\cb3   \cf10 \strokec10 f1Array\cf8 \strokec8 ,\cf4 \strokec4  \cf2 \strokec2 // f1\cf4 \cb1 \strokec4 \
\cb3   \cf10 \strokec10 f2Array\cf8 \strokec8 ,\cf4 \strokec4  \cf2 \strokec2 // f2\cf4 \cb1 \strokec4 \
\cb3   \cf10 \strokec10 f3Array\cf8 \strokec8 ,\cf4 \strokec4  \cf2 \strokec2 // f3\cf4 \cb1 \strokec4 \
\cb3   \cf10 \strokec10 f4Array\cf8 \strokec8 ,\cf4 \strokec4  \cf2 \strokec2 // f4\cf4 \cb1 \strokec4 \
\cb3   \cf10 \strokec10 f5Array\cf4 \strokec4   \cf2 \strokec2 // f5\cf4 \cb1 \strokec4 \
\cb3  \cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf2 \cb3 \strokec2 // Label Object: Used for classifying historical data as training data for the ML Model\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0

\f1\b \cf8 \cb3 \strokec8 Label
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 direction\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cb1 \
\pard\pardeftab720\sl360\partightenfactor0
\cf4 \cb3  \cf13 \strokec13 Label.new\cf6 \strokec6 (\cf4 \cb1 \strokec4 \
\cb3    \cf10 \strokec10 long\cf8 \strokec8 =\cf11 \strokec11 1\cf8 \strokec8 ,\cf4 \strokec4  \cb1 \
\cb3    \cf10 \strokec10 short\cf8 \strokec8 =\cf11 \strokec11 -1\cf8 \strokec8 ,\cf4 \strokec4  \cb1 \
\cb3    \cf10 \strokec10 neutral\cf8 \strokec8 =\cf11 \strokec11 0\cf4 \cb1 \strokec4 \
\cb3   \cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf2 \cb3 \strokec2 // Derived from General Settings\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf10 \cb3 \strokec10 maxBarsBackIndex\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf9 \strokec9 last_bar_index\cf4 \strokec4  \cf8 \strokec8 >=\cf4 \strokec4  \cf10 \strokec10 settings\cf4 \strokec4 .\cf10 \strokec10 maxBarsBack\cf4 \strokec4  \cf8 \strokec8 ?\cf4 \strokec4  \cf9 \strokec9 last_bar_index\cf4 \strokec4  \cf8 \strokec8 -\cf4 \strokec4  \cf10 \strokec10 settings\cf4 \strokec4 .\cf10 \strokec10 maxBarsBack\cf4 \strokec4  \cf8 \strokec8 :\cf4 \strokec4  \cf11 \strokec11 0\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf2 \cb3 \strokec2 // EMA Settings \cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf10 \cb3 \strokec10 useEmaFilter\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 input.bool\cf6 \strokec6 (\cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 "Use EMA Filter"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 defval\cf8 \strokec8 =\cf9 \strokec9 false\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "Filters"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 inline\cf8 \strokec8 =\cf7 \strokec7 "ema"\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 emaPeriod\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 input.int\cf6 \strokec6 (\cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 "Period"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 defval\cf8 \strokec8 =\cf11 \strokec11 200\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 minval\cf8 \strokec8 =\cf11 \strokec11 1\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 step\cf8 \strokec8 =\cf11 \strokec11 1\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "Filters"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 inline\cf8 \strokec8 =\cf7 \strokec7 "ema"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tooltip\cf8 \strokec8 =\cf7 \strokec7 "The period of the EMA used for the EMA Filter."\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 isEmaUptrend\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 useEmaFilter\cf4 \strokec4  \cf8 \strokec8 ?\cf4 \strokec4  \cf9 \strokec9 close\cf4 \strokec4  \cf8 \strokec8 >\cf4 \strokec4  \cf5 \strokec5 ta.ema\cf6 \strokec6 (\cf9 \strokec9 close\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 emaPeriod\cf6 \strokec6 )\cf4 \strokec4  \cf8 \strokec8 :\cf4 \strokec4  \cf9 \strokec9 true\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 isEmaDowntrend\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 useEmaFilter\cf4 \strokec4  \cf8 \strokec8 ?\cf4 \strokec4  \cf9 \strokec9 close\cf4 \strokec4  \cf8 \strokec8 <\cf4 \strokec4  \cf5 \strokec5 ta.ema\cf6 \strokec6 (\cf9 \strokec9 close\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 emaPeriod\cf6 \strokec6 )\cf4 \strokec4  \cf8 \strokec8 :\cf4 \strokec4  \cf9 \strokec9 true\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 useSmaFilter\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 input.bool\cf6 \strokec6 (\cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 "Use SMA Filter"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 defval\cf8 \strokec8 =\cf9 \strokec9 false\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "Filters"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 inline\cf8 \strokec8 =\cf7 \strokec7 "sma"\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 smaPeriod\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 input.int\cf6 \strokec6 (\cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 "Period"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 defval\cf8 \strokec8 =\cf11 \strokec11 200\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 minval\cf8 \strokec8 =\cf11 \strokec11 1\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 step\cf8 \strokec8 =\cf11 \strokec11 1\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "Filters"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 inline\cf8 \strokec8 =\cf7 \strokec7 "sma"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tooltip\cf8 \strokec8 =\cf7 \strokec7 "The period of the SMA used for the SMA Filter."\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 isSmaUptrend\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 useSmaFilter\cf4 \strokec4  \cf8 \strokec8 ?\cf4 \strokec4  \cf9 \strokec9 close\cf4 \strokec4  \cf8 \strokec8 >\cf4 \strokec4  \cf5 \strokec5 ta.sma\cf6 \strokec6 (\cf9 \strokec9 close\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 smaPeriod\cf6 \strokec6 )\cf4 \strokec4  \cf8 \strokec8 :\cf4 \strokec4  \cf9 \strokec9 true\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 isSmaDowntrend\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 useSmaFilter\cf4 \strokec4  \cf8 \strokec8 ?\cf4 \strokec4  \cf9 \strokec9 close\cf4 \strokec4  \cf8 \strokec8 <\cf4 \strokec4  \cf5 \strokec5 ta.sma\cf6 \strokec6 (\cf9 \strokec9 close\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 smaPeriod\cf6 \strokec6 )\cf4 \strokec4  \cf8 \strokec8 :\cf4 \strokec4  \cf9 \strokec9 true\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf2 \cb3 \strokec2 // Nadaraya-Watson Kernel Regression Settings\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf10 \cb3 \strokec10 useKernelFilter\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 input.bool\cf6 \strokec6 (\cf9 \strokec9 true\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 "Trade with Kernel"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "Kernel Settings"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 inline\cf8 \strokec8 =\cf7 \strokec7 "kernel"\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 showKernelEstimate\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 input.bool\cf6 \strokec6 (\cf9 \strokec9 true\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 "Show Kernel Estimate"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "Kernel Settings"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 inline\cf8 \strokec8 =\cf7 \strokec7 "kernel"\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 useKernelSmoothing\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 input.bool\cf6 \strokec6 (\cf9 \strokec9 false\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 "Enhance Kernel Smoothing"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tooltip\cf8 \strokec8 =\cf7 \strokec7 "Uses a crossover based mechanism to smoothen kernel color changes. This often results in less color transitions overall and may result in more ML entry signals being generated."\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 inline\cf8 \strokec8 =\cf7 \strokec7 '1'\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 'Kernel Settings'\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 h\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 input.int\cf6 \strokec6 (\cf11 \strokec11 8\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 'Lookback Window'\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 minval\cf8 \strokec8 =\cf11 \strokec11 3\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tooltip\cf8 \strokec8 =\cf7 \strokec7 'The number of bars used for the estimation. This is a sliding value that represents the most recent historical bars. Recommended range: 3-50'\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "Kernel Settings"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 inline\cf8 \strokec8 =\cf7 \strokec7 "kernel"\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 r\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 input.float\cf6 \strokec6 (\cf11 \strokec11 8.\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 'Relative Weighting'\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 step\cf8 \strokec8 =\cf11 \strokec11 0.25\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tooltip\cf8 \strokec8 =\cf7 \strokec7 'Relative weighting of time frames. As this value approaches zero, the longer time frames will exert more influence on the estimation. As this value approaches infinity, the behavior of the Rational Quadratic Kernel will become identical to the Gaussian kernel. Recommended range: 0.25-25'\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "Kernel Settings"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 inline\cf8 \strokec8 =\cf7 \strokec7 "kernel"\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 x\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 input.int\cf6 \strokec6 (\cf11 \strokec11 25\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 "Regression Level"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tooltip\cf8 \strokec8 =\cf7 \strokec7 'Bar index on which to start regression. Controls how tightly fit the kernel estimate is to the data. Smaller values are a tighter fit. Larger values are a looser fit. Recommended range: 2-25'\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "Kernel Settings"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 inline\cf8 \strokec8 =\cf7 \strokec7 "kernel"\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 lag\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 input.int\cf6 \strokec6 (\cf11 \strokec11 2\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 "Lag"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tooltip\cf8 \strokec8 =\cf7 \strokec7 "Lag for crossover detection. Lower values result in earlier crossovers. Recommended range: 1-2"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 inline\cf8 \strokec8 =\cf7 \strokec7 '1'\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 'Kernel Settings'\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf2 \cb3 \strokec2 // Display Settings\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf10 \cb3 \strokec10 showBarColors\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 input.bool\cf6 \strokec6 (\cf9 \strokec9 true\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 "Show Bar Colors"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tooltip\cf8 \strokec8 =\cf7 \strokec7 "Whether to show the bar colors."\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "Display Settings"\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 showBarPredictions\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 input.bool\cf6 \strokec6 (\cf10 \strokec10 defval\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf9 \strokec9 true\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 title\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf7 \strokec7 "Show Bar Prediction Values"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tooltip\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf7 \strokec7 "Will show the ML model's evaluation of each bar as an integer."\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "Display Settings"\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 useAtrOffset\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 input.bool\cf6 \strokec6 (\cf10 \strokec10 defval\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf9 \strokec9 false\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 title\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf7 \strokec7 "Use ATR Offset"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tooltip\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf7 \strokec7 "Will use the ATR offset instead of the bar prediction offset."\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "Display Settings"\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 barPredictionsOffset\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 input.float\cf6 \strokec6 (\cf11 \strokec11 0\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 "Bar Prediction Offset"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 minval\cf8 \strokec8 =\cf11 \strokec11 0\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tooltip\cf8 \strokec8 =\cf7 \strokec7 "The offset of the bar predictions as a percentage from the bar high or close."\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 group\cf8 \strokec8 =\cf7 \strokec7 "Display Settings"\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf2 \cb3 \strokec2 // =================================\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // ==== Next Bar Classification ====\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // =================================\cf4 \cb1 \strokec4 \
\
\cf2 \cb3 \strokec2 // This model specializes specifically in predicting the direction of price action over the course of the next 4 bars. \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // To avoid complications with the ML model, this value is hardcoded to 4 bars but support for other training lengths may be added in the future.\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf10 \cb3 \strokec10 src\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 settings\cf4 \strokec4 .\cf10 \strokec10 source\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 y_train_series\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 src\cf6 \strokec6 [\cf11 \strokec11 4\cf6 \strokec6 ]\cf4 \strokec4  \cf8 \strokec8 <\cf4 \strokec4  \cf10 \strokec10 src\cf6 \strokec6 [\cf11 \strokec11 0\cf6 \strokec6 ]\cf4 \strokec4  \cf8 \strokec8 ?\cf4 \strokec4  \cf10 \strokec10 direction\cf4 \strokec4 .\cf10 \strokec10 short\cf4 \strokec4  \cf8 \strokec8 :\cf4 \strokec4  \cf10 \strokec10 src\cf6 \strokec6 [\cf11 \strokec11 4\cf6 \strokec6 ]\cf4 \strokec4  \cf8 \strokec8 >\cf4 \strokec4  \cf10 \strokec10 src\cf6 \strokec6 [\cf11 \strokec11 0\cf6 \strokec6 ]\cf4 \strokec4  \cf8 \strokec8 ?\cf4 \strokec4  \cf10 \strokec10 direction\cf4 \strokec4 .\cf10 \strokec10 long\cf4 \strokec4  \cf8 \strokec8 :\cf4 \strokec4  \cf10 \strokec10 direction\cf4 \strokec4 .\cf10 \strokec10 neutral\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf8 \cb3 \strokec8 var\cf4 \strokec4  \cf10 \strokec10 y_train_array\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 array.new_int\cf6 \strokec6 (\cf11 \strokec11 0\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf2 \cb3 \strokec2 // Variables used for ML Logic\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf8 \cb3 \strokec8 var\cf4 \strokec4  \cf10 \strokec10 predictions\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 array.new_float\cf6 \strokec6 (\cf11 \strokec11 0\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf8 \cb3 \strokec8 var\cf4 \strokec4  \cf10 \strokec10 prediction\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf11 \strokec11 0.\cf4 \cb1 \strokec4 \
\cf8 \cb3 \strokec8 var\cf4 \strokec4  \cf10 \strokec10 signal\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 direction\cf4 \strokec4 .\cf10 \strokec10 neutral\cf4 \cb1 \strokec4 \
\cf8 \cb3 \strokec8 var\cf4 \strokec4  \cf10 \strokec10 distances\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 array.new_float\cf6 \strokec6 (\cf11 \strokec11 0\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf5 \cb3 \strokec5 array.push\cf6 \strokec6 (\cf10 \strokec10 y_train_array\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 y_train_series\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf2 \cb3 \strokec2 // =========================\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // ====  Core ML Logic  ====\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // =========================\cf4 \cb1 \strokec4 \
\
\cf2 \cb3 \strokec2 // Approximate Nearest Neighbors Search with Lorentzian Distance:\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // A novel variation of the Nearest Neighbors (NN) search algorithm that ensures a chronologically uniform distribution of neighbors.\cf4 \cb1 \strokec4 \
\
\cf2 \cb3 \strokec2 // In a traditional KNN-based approach, we would iterate through the entire dataset and calculate the distance between the current bar \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // and every other bar in the dataset and then sort the distances in ascending order. We would then take the first k bars and use their \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // labels to determine the label of the current bar. \cf4 \cb1 \strokec4 \
\
\cf2 \cb3 \strokec2 // There are several problems with this traditional KNN approach in the context of real-time calculations involving time series data:\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // - It is computationally expensive to iterate through the entire dataset and calculate the distance between every historical bar and\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //   the current bar.\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // - Market time series data is often non-stationary, meaning that the statistical properties of the data change slightly over time.\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // - It is possible that the nearest neighbors are not the most informative ones, and the KNN algorithm may return poor results if the\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //   nearest neighbors are not representative of the majority of the data.\cf4 \cb1 \strokec4 \
\
\cf2 \cb3 \strokec2 // Previously, the user @capissimo attempted to address some of these issues in several of his PineScript-based KNN implementations by:\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // - Using a modified KNN algorithm based on consecutive furthest neighbors to find a set of approximate "nearest" neighbors.\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // - Using a sliding window approach to only calculate the distance between the current bar and the most recent n bars in the dataset.\cf4 \cb1 \strokec4 \
\
\cf2 \cb3 \strokec2 // Of these two approaches, the latter is inherently limited by the fact that it only considers the most recent bars in the overall dataset. \cf4 \cb1 \strokec4 \
\
\cf2 \cb3 \strokec2 // The former approach has more potential to leverage historical price action, but is limited by:\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // - The possibility of a sudden "max" value throwing off the estimation\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // - The possibility of selecting a set of approximate neighbors that are not representative of the majority of the data by oversampling \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //   values that are not chronologically distinct enough from one another\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // - The possibility of selecting too many "far" neighbors, which may result in a poor estimation of price action\cf4 \cb1 \strokec4 \
\
\cf2 \cb3 \strokec2 // To address these issues, a novel Approximate Nearest Neighbors (ANN) algorithm is used in this indicator.\cf4 \cb1 \strokec4 \
\
\cf2 \cb3 \strokec2 // In the below ANN algorithm:\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // 1. The algorithm iterates through the dataset in chronological order, using the modulo operator to only perform calculations every 4 bars.\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //    This serves the dual purpose of reducing the computational overhead of the algorithm and ensuring a minimum chronological spacing \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //    between the neighbors of at least 4 bars.\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // 2. A list of the k-similar neighbors is simultaneously maintained in both a predictions array and corresponding distances array.\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // 3. When the size of the predictions array exceeds the desired number of nearest neighbors specified in settings.neighborsCount, \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //    the algorithm removes the first neighbor from the predictions array and the corresponding distance array.\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // 4. The lastDistance variable is overriden to be a distance in the lower 25% of the array. This step helps to boost overall accuracy \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //    by ensuring subsequent newly added distance values increase at a slower rate.\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // 5. Lorentzian distance is used as a distance metric in order to minimize the effect of outliers and take into account the warping of \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 //    "price-time" due to proximity to significant economic events.\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf10 \cb3 \strokec10 lastDistance\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf11 \strokec11 -1.0\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 size\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 math.min\cf6 \strokec6 (\cf10 \strokec10 settings\cf4 \strokec4 .\cf10 \strokec10 maxBarsBack\cf11 \strokec11 -1\cf8 \strokec8 ,\cf4 \strokec4  \cf5 \strokec5 array.size\cf6 \strokec6 (\cf10 \strokec10 y_train_array\cf6 \strokec6 )\cf11 \strokec11 -1\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 sizeLoop\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 math.min\cf6 \strokec6 (\cf10 \strokec10 settings\cf4 \strokec4 .\cf10 \strokec10 maxBarsBack\cf11 \strokec11 -1\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 size\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf8 \cb3 \strokec8 if\cf4 \strokec4  \cf9 \strokec9 bar_index\cf4 \strokec4  \cf8 \strokec8 >=\cf4 \strokec4  \cf10 \strokec10 maxBarsBackIndex\cf4 \strokec4  \cf2 \strokec2 //\{\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf4 \cb3     
\f1\b \cf8 \strokec8 for
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 i\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf11 \strokec11 0\cf4 \strokec4  \cf8 \strokec8 to\cf4 \strokec4  \cf10 \strokec10 sizeLoop\cf4 \strokec4  \cf2 \strokec2 //\{\cf4 \cb1 \strokec4 \
\cb3         \cf10 \strokec10 d\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf13 \strokec13 get_lorentzian_distance\cf6 \strokec6 (\cf10 \strokec10 i\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 settings\cf4 \strokec4 .\cf10 \strokec10 featureCount\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 featureSeries\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 featureArrays\cf6 \strokec6 )\cf4 \strokec4  \cb1 \
\cb3         \cf8 \strokec8 if\cf4 \strokec4  \cf10 \strokec10 d\cf4 \strokec4  \cf8 \strokec8 >=\cf4 \strokec4  \cf10 \strokec10 lastDistance\cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf10 \strokec10 i\cf8 \strokec8 %\cf11 \strokec11 4\cf4 \strokec4  \cf2 \strokec2 //\{\cf4 \cb1 \strokec4 \
\cb3             \cf10 \strokec10 lastDistance\cf4 \strokec4  \cf8 \strokec8 :=\cf4 \strokec4  \cf10 \strokec10 d\cf4 \strokec4             \cb1 \
\cb3             \cf5 \strokec5 array.push\cf6 \strokec6 (\cf10 \strokec10 distances\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 d\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cb3             \cf5 \strokec5 array.push\cf6 \strokec6 (\cf10 \strokec10 predictions\cf8 \strokec8 ,\cf4 \strokec4  \cf5 \strokec5 math.round\cf6 \strokec6 (\cf5 \strokec5 array.get\cf6 \strokec6 (\cf10 \strokec10 y_train_array\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 i\cf6 \strokec6 )))\cf4 \cb1 \strokec4 \
\cb3             \cf8 \strokec8 if\cf4 \strokec4  \cf5 \strokec5 array.size\cf6 \strokec6 (\cf10 \strokec10 predictions\cf6 \strokec6 )\cf4 \strokec4  \cf8 \strokec8 >\cf4 \strokec4  \cf10 \strokec10 settings\cf4 \strokec4 .\cf10 \strokec10 neighborsCount\cf4 \strokec4  \cf2 \strokec2 //\{\cf4 \cb1 \strokec4 \
\cb3                 \cf10 \strokec10 lastDistance\cf4 \strokec4  \cf8 \strokec8 :=\cf4 \strokec4  \cf5 \strokec5 array.get\cf6 \strokec6 (\cf10 \strokec10 distances\cf8 \strokec8 ,\cf4 \strokec4  \cf5 \strokec5 math.round\cf6 \strokec6 (\cf10 \strokec10 settings\cf4 \strokec4 .\cf10 \strokec10 neighborsCount\cf8 \strokec8 *\cf11 \strokec11 3\cf8 \strokec8 /\cf11 \strokec11 4\cf6 \strokec6 ))\cf4 \cb1 \strokec4 \
\cb3                 \cf5 \strokec5 array.shift\cf6 \strokec6 (\cf10 \strokec10 distances\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cb3                 \cf5 \strokec5 array.shift\cf6 \strokec6 (\cf10 \strokec10 predictions\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cb3             \cf2 \strokec2 //\}\cf4 \cb1 \strokec4 \
\cb3         \cf2 \strokec2 //\}\cf4 \cb1 \strokec4 \
\cb3     \cf2 \strokec2 //\}\cf4 \cb1 \strokec4 \
\cb3     \cf10 \strokec10 prediction\cf4 \strokec4  \cf8 \strokec8 :=\cf4 \strokec4  \cf5 \strokec5 array.sum\cf6 \strokec6 (\cf10 \strokec10 predictions\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf2 \cb3 \strokec2 //\}\cf4 \cb1 \strokec4 \
\
\cf2 \cb3 \strokec2 // ============================\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // ==== Prediction Filters ====\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // ============================\cf4 \cb1 \strokec4 \
\
\cf2 \cb3 \strokec2 // User Defined Filters: Used for adjusting the frequency of the ML Model's predictions\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf10 \cb3 \strokec10 filter_all\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 filter\cf4 \strokec4 .\cf10 \strokec10 volatility\cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf10 \strokec10 filter\cf4 \strokec4 .\cf10 \strokec10 regime\cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf10 \strokec10 filter\cf4 \strokec4 .\cf10 \strokec10 adx\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf2 \cb3 \strokec2 // Filtered Signal: The model's prediction of future price movement direction with user-defined filters applied\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf10 \cb3 \strokec10 signal\cf4 \strokec4  \cf8 \strokec8 :=\cf4 \strokec4  \cf10 \strokec10 prediction\cf4 \strokec4  \cf8 \strokec8 >\cf4 \strokec4  \cf11 \strokec11 0\cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf10 \strokec10 filter_all\cf4 \strokec4  \cf8 \strokec8 ?\cf4 \strokec4  \cf10 \strokec10 direction\cf4 \strokec4 .\cf10 \strokec10 long\cf4 \strokec4  \cf8 \strokec8 :\cf4 \strokec4  \cf10 \strokec10 prediction\cf4 \strokec4  \cf8 \strokec8 <\cf4 \strokec4  \cf11 \strokec11 0\cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf10 \strokec10 filter_all\cf4 \strokec4  \cf8 \strokec8 ?\cf4 \strokec4  \cf10 \strokec10 direction\cf4 \strokec4 .\cf10 \strokec10 short\cf4 \strokec4  \cf8 \strokec8 :\cf4 \strokec4  \cf5 \strokec5 nz\cf6 \strokec6 (\cf10 \strokec10 signal\cf6 \strokec6 [\cf11 \strokec11 1\cf6 \strokec6 ])\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf2 \cb3 \strokec2 // Bar-Count Filters: Represents strict filters based on a pre-defined holding period of 4 bars\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf8 \cb3 \strokec8 var\cf4 \strokec4  
\f1\b \cf8 \strokec8 int
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 barsHeld\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf11 \strokec11 0\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf10 \cb3 \strokec10 barsHeld\cf4 \strokec4  \cf8 \strokec8 :=\cf4 \strokec4  \cf5 \strokec5 ta.change\cf6 \strokec6 (\cf10 \strokec10 signal\cf6 \strokec6 )\cf4 \strokec4  \cf8 \strokec8 ?\cf4 \strokec4  \cf11 \strokec11 0\cf4 \strokec4  \cf8 \strokec8 :\cf4 \strokec4  \cf10 \strokec10 barsHeld\cf4 \strokec4  \cf8 \strokec8 +\cf4 \strokec4  \cf11 \strokec11 1\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 isHeldFourBars\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 barsHeld\cf4 \strokec4  \cf8 \strokec8 ==\cf4 \strokec4  \cf11 \strokec11 4\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 isHeldLessThanFourBars\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf11 \strokec11 0\cf4 \strokec4  \cf8 \strokec8 <\cf4 \strokec4  \cf10 \strokec10 barsHeld\cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf10 \strokec10 barsHeld\cf4 \strokec4  \cf8 \strokec8 <\cf4 \strokec4  \cf11 \strokec11 4\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf2 \cb3 \strokec2 // Fractal Filters: Derived from relative appearances of signals in a given time series fractal/segment with a default length of 4 bars\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf10 \cb3 \strokec10 isDifferentSignalType\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 ta.change\cf6 \strokec6 (\cf10 \strokec10 signal\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 isEarlySignalFlip\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 ta.change\cf6 \strokec6 (\cf10 \strokec10 signal\cf6 \strokec6 )\cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf6 \strokec6 (\cf5 \strokec5 ta.change\cf6 \strokec6 (\cf10 \strokec10 signal\cf6 \strokec6 [\cf11 \strokec11 1\cf6 \strokec6 ])\cf4 \strokec4  \cf8 \strokec8 or\cf4 \strokec4  \cf5 \strokec5 ta.change\cf6 \strokec6 (\cf10 \strokec10 signal\cf6 \strokec6 [\cf11 \strokec11 2\cf6 \strokec6 ])\cf4 \strokec4  \cf8 \strokec8 or\cf4 \strokec4  \cf5 \strokec5 ta.change\cf6 \strokec6 (\cf10 \strokec10 signal\cf6 \strokec6 [\cf11 \strokec11 3\cf6 \strokec6 ]))\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 isBuySignal\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 signal\cf4 \strokec4  \cf8 \strokec8 ==\cf4 \strokec4  \cf10 \strokec10 direction\cf4 \strokec4 .\cf10 \strokec10 long\cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf10 \strokec10 isEmaUptrend\cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf10 \strokec10 isSmaUptrend\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 isSellSignal\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 signal\cf4 \strokec4  \cf8 \strokec8 ==\cf4 \strokec4  \cf10 \strokec10 direction\cf4 \strokec4 .\cf10 \strokec10 short\cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf10 \strokec10 isEmaDowntrend\cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf10 \strokec10 isSmaDowntrend\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 isLastSignalBuy\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 signal\cf6 \strokec6 [\cf11 \strokec11 4\cf6 \strokec6 ]\cf4 \strokec4  \cf8 \strokec8 ==\cf4 \strokec4  \cf10 \strokec10 direction\cf4 \strokec4 .\cf10 \strokec10 long\cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf10 \strokec10 isEmaUptrend\cf6 \strokec6 [\cf11 \strokec11 4\cf6 \strokec6 ]\cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf10 \strokec10 isSmaUptrend\cf6 \strokec6 [\cf11 \strokec11 4\cf6 \strokec6 ]\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 isLastSignalSell\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 signal\cf6 \strokec6 [\cf11 \strokec11 4\cf6 \strokec6 ]\cf4 \strokec4  \cf8 \strokec8 ==\cf4 \strokec4  \cf10 \strokec10 direction\cf4 \strokec4 .\cf10 \strokec10 short\cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf10 \strokec10 isEmaDowntrend\cf6 \strokec6 [\cf11 \strokec11 4\cf6 \strokec6 ]\cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf10 \strokec10 isSmaDowntrend\cf6 \strokec6 [\cf11 \strokec11 4\cf6 \strokec6 ]\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 isNewBuySignal\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 isBuySignal\cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf10 \strokec10 isDifferentSignalType\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 isNewSellSignal\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 isSellSignal\cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf10 \strokec10 isDifferentSignalType\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf2 \cb3 \strokec2 // Kernel Regression Filters: Filters based on Nadaraya-Watson Kernel Regression using the Rational Quadratic Kernel\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // For more information on this technique refer to my other open source indicator located here: \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // https://www.tradingview.com/script/AWNvbPRM-Nadaraya-Watson-Rational-Quadratic-Kernel-Non-Repainting/\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf10 \cb3 \strokec10 c_green\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 color.new\cf6 \strokec6 (\cf9 \strokec9 #009988\cf8 \strokec8 ,\cf4 \strokec4  \cf11 \strokec11 20\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 c_red\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 color.new\cf6 \strokec6 (\cf9 \strokec9 #CC3311\cf8 \strokec8 ,\cf4 \strokec4  \cf11 \strokec11 20\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 transparent\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 color.new\cf6 \strokec6 (\cf9 \strokec9 #000000\cf8 \strokec8 ,\cf4 \strokec4  \cf11 \strokec11 100\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 yhat1\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf12 \strokec12 kernels.rationalQuadratic\cf6 \strokec6 (\cf10 \strokec10 settings\cf4 \strokec4 .\cf10 \strokec10 source\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 h\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 r\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 x\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 yhat2\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf12 \strokec12 kernels.gaussian\cf6 \strokec6 (\cf10 \strokec10 settings\cf4 \strokec4 .\cf10 \strokec10 source\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 h\cf8 \strokec8 -\cf10 \strokec10 lag\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 x\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 kernelEstimate\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 yhat1\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf2 \cb3 \strokec2 // Kernel Rates of Change\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0

\f1\b \cf8 \cb3 \strokec8 bool
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 wasBearishRate\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 yhat1\cf6 \strokec6 [\cf11 \strokec11 2\cf6 \strokec6 ]\cf4 \strokec4  \cf8 \strokec8 >\cf4 \strokec4  \cf10 \strokec10 yhat1\cf6 \strokec6 [\cf11 \strokec11 1\cf6 \strokec6 ]\cf4 \cb1 \strokec4 \

\f1\b \cf8 \cb3 \strokec8 bool
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 wasBullishRate\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 yhat1\cf6 \strokec6 [\cf11 \strokec11 2\cf6 \strokec6 ]\cf4 \strokec4  \cf8 \strokec8 <\cf4 \strokec4  \cf10 \strokec10 yhat1\cf6 \strokec6 [\cf11 \strokec11 1\cf6 \strokec6 ]\cf4 \cb1 \strokec4 \

\f1\b \cf8 \cb3 \strokec8 bool
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 isBearishRate\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 yhat1\cf6 \strokec6 [\cf11 \strokec11 1\cf6 \strokec6 ]\cf4 \strokec4  \cf8 \strokec8 >\cf4 \strokec4  \cf10 \strokec10 yhat1\cf4 \cb1 \strokec4 \

\f1\b \cf8 \cb3 \strokec8 bool
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 isBullishRate\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 yhat1\cf6 \strokec6 [\cf11 \strokec11 1\cf6 \strokec6 ]\cf4 \strokec4  \cf8 \strokec8 <\cf4 \strokec4  \cf10 \strokec10 yhat1\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf10 \cb3 \strokec10 isBearishChange\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 isBearishRate\cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf10 \strokec10 wasBullishRate\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 isBullishChange\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 isBullishRate\cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf10 \strokec10 wasBearishRate\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf2 \cb3 \strokec2 // Kernel Crossovers\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0

\f1\b \cf8 \cb3 \strokec8 bool
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 isBullishCrossAlert\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 ta.crossover\cf6 \strokec6 (\cf10 \strokec10 yhat2\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 yhat1\cf6 \strokec6 )\cf4 \cb1 \strokec4 \

\f1\b \cf8 \cb3 \strokec8 bool
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 isBearishCrossAlert\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 ta.crossunder\cf6 \strokec6 (\cf10 \strokec10 yhat2\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 yhat1\cf6 \strokec6 )\cf4 \strokec4  \cb1 \

\f1\b \cf8 \cb3 \strokec8 bool
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 isBullishSmooth\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 yhat2\cf4 \strokec4  \cf8 \strokec8 >=\cf4 \strokec4  \cf10 \strokec10 yhat1\cf4 \cb1 \strokec4 \

\f1\b \cf8 \cb3 \strokec8 bool
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 isBearishSmooth\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 yhat2\cf4 \strokec4  \cf8 \strokec8 <=\cf4 \strokec4  \cf10 \strokec10 yhat1\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf2 \cb3 \strokec2 // Kernel Colors\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0

\f1\b \cf8 \cb3 \strokec8 color
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 colorByCross\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 isBullishSmooth\cf4 \strokec4  \cf8 \strokec8 ?\cf4 \strokec4  \cf10 \strokec10 c_green\cf4 \strokec4  \cf8 \strokec8 :\cf4 \strokec4  \cf10 \strokec10 c_red\cf4 \cb1 \strokec4 \

\f1\b \cf8 \cb3 \strokec8 color
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 colorByRate\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 isBullishRate\cf4 \strokec4  \cf8 \strokec8 ?\cf4 \strokec4  \cf10 \strokec10 c_green\cf4 \strokec4  \cf8 \strokec8 :\cf4 \strokec4  \cf10 \strokec10 c_red\cf4 \cb1 \strokec4 \

\f1\b \cf8 \cb3 \strokec8 color
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 plotColor\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 showKernelEstimate\cf4 \strokec4  \cf8 \strokec8 ?\cf4 \strokec4  \cf6 \strokec6 (\cf10 \strokec10 useKernelSmoothing\cf4 \strokec4  \cf8 \strokec8 ?\cf4 \strokec4  \cf10 \strokec10 colorByCross\cf4 \strokec4  \cf8 \strokec8 :\cf4 \strokec4  \cf10 \strokec10 colorByRate\cf6 \strokec6 )\cf4 \strokec4  \cf8 \strokec8 :\cf4 \strokec4  \cf10 \strokec10 transparent\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf5 \cb3 \strokec5 plot\cf6 \strokec6 (\cf10 \strokec10 kernelEstimate\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 color\cf8 \strokec8 =\cf10 \strokec10 plotColor\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 linewidth\cf8 \strokec8 =\cf11 \strokec11 2\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 "Kernel Regression Estimate"\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf2 \cb3 \strokec2 // Alert Variables\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0

\f1\b \cf8 \cb3 \strokec8 bool
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 alertBullish\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 useKernelSmoothing\cf4 \strokec4  \cf8 \strokec8 ?\cf4 \strokec4  \cf10 \strokec10 isBullishCrossAlert\cf4 \strokec4  \cf8 \strokec8 :\cf4 \strokec4  \cf10 \strokec10 isBullishChange\cf4 \cb1 \strokec4 \

\f1\b \cf8 \cb3 \strokec8 bool
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 alertBearish\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 useKernelSmoothing\cf4 \strokec4  \cf8 \strokec8 ?\cf4 \strokec4  \cf10 \strokec10 isBearishCrossAlert\cf4 \strokec4  \cf8 \strokec8 :\cf4 \strokec4  \cf10 \strokec10 isBearishChange\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf2 \cb3 \strokec2 // Bullish and Bearish Filters based on Kernel\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf10 \cb3 \strokec10 isBullish\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 useKernelFilter\cf4 \strokec4  \cf8 \strokec8 ?\cf4 \strokec4  \cf6 \strokec6 (\cf10 \strokec10 useKernelSmoothing\cf4 \strokec4  \cf8 \strokec8 ?\cf4 \strokec4  \cf10 \strokec10 isBullishSmooth\cf4 \strokec4  \cf8 \strokec8 :\cf4 \strokec4  \cf10 \strokec10 isBullishRate\cf6 \strokec6 )\cf4 \strokec4  \cf8 \strokec8 :\cf4 \strokec4  \cf9 \strokec9 true\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 isBearish\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 useKernelFilter\cf4 \strokec4  \cf8 \strokec8 ?\cf4 \strokec4  \cf6 \strokec6 (\cf10 \strokec10 useKernelSmoothing\cf4 \strokec4  \cf8 \strokec8 ?\cf4 \strokec4  \cf10 \strokec10 isBearishSmooth\cf4 \strokec4  \cf8 \strokec8 :\cf4 \strokec4  \cf10 \strokec10 isBearishRate\cf6 \strokec6 )\cf4 \strokec4  \cf8 \strokec8 :\cf4 \strokec4  \cf9 \strokec9 true\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf2 \cb3 \strokec2 // ===========================\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // ==== Entries and Exits ====\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // ===========================\cf4 \cb1 \strokec4 \
\
\cf2 \cb3 \strokec2 // Entry Conditions: Booleans for ML Model Position Entries\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf10 \cb3 \strokec10 startLongTrade\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 isNewBuySignal\cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf10 \strokec10 isBullish\cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf10 \strokec10 isEmaUptrend\cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf10 \strokec10 isSmaUptrend\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 startShortTrade\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 isNewSellSignal\cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf10 \strokec10 isBearish\cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf10 \strokec10 isEmaDowntrend\cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf10 \strokec10 isSmaDowntrend\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf2 \cb3 \strokec2 // Dynamic Exit Conditions: Booleans for ML Model Position Exits based on Fractal Filters and Kernel Regression Filters\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf10 \cb3 \strokec10 lastSignalWasBullish\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 ta.barssince\cf6 \strokec6 (\cf10 \strokec10 startLongTrade\cf6 \strokec6 )\cf4 \strokec4  \cf8 \strokec8 <\cf4 \strokec4  \cf5 \strokec5 ta.barssince\cf6 \strokec6 (\cf10 \strokec10 startShortTrade\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 lastSignalWasBearish\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 ta.barssince\cf6 \strokec6 (\cf10 \strokec10 startShortTrade\cf6 \strokec6 )\cf4 \strokec4  \cf8 \strokec8 <\cf4 \strokec4  \cf5 \strokec5 ta.barssince\cf6 \strokec6 (\cf10 \strokec10 startLongTrade\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 barsSinceRedEntry\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 ta.barssince\cf6 \strokec6 (\cf10 \strokec10 startShortTrade\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 barsSinceRedExit\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 ta.barssince\cf6 \strokec6 (\cf10 \strokec10 alertBullish\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 barsSinceGreenEntry\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 ta.barssince\cf6 \strokec6 (\cf10 \strokec10 startLongTrade\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 barsSinceGreenExit\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 ta.barssince\cf6 \strokec6 (\cf10 \strokec10 alertBearish\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 isValidShortExit\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 barsSinceRedExit\cf4 \strokec4  \cf8 \strokec8 >\cf4 \strokec4  \cf10 \strokec10 barsSinceRedEntry\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 isValidLongExit\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 barsSinceGreenExit\cf4 \strokec4  \cf8 \strokec8 >\cf4 \strokec4  \cf10 \strokec10 barsSinceGreenEntry\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 endLongTradeDynamic\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf6 \strokec6 (\cf10 \strokec10 isBearishChange\cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf10 \strokec10 isValidLongExit\cf6 \strokec6 [\cf11 \strokec11 1\cf6 \strokec6 ])\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 endShortTradeDynamic\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf6 \strokec6 (\cf10 \strokec10 isBullishChange\cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf10 \strokec10 isValidShortExit\cf6 \strokec6 [\cf11 \strokec11 1\cf6 \strokec6 ])\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf2 \cb3 \strokec2 // Fixed Exit Conditions: Booleans for ML Model Position Exits based on a Bar-Count Filters\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf10 \cb3 \strokec10 endLongTradeStrict\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf6 \strokec6 ((
\f1\b \cf8 \strokec8 isHeldFourBars
\f0\b0 \cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf10 \strokec10 isLastSignalBuy\cf6 \strokec6 )\cf4 \strokec4  \cf8 \strokec8 or\cf4 \strokec4  \cf6 \strokec6 (
\f1\b \cf8 \strokec8 isHeldLessThanFourBars
\f0\b0 \cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf10 \strokec10 isNewSellSignal\cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf10 \strokec10 isLastSignalBuy\cf6 \strokec6 ))\cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf10 \strokec10 startLongTrade\cf6 \strokec6 [\cf11 \strokec11 4\cf6 \strokec6 ]\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 endShortTradeStrict\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf6 \strokec6 ((
\f1\b \cf8 \strokec8 isHeldFourBars
\f0\b0 \cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf10 \strokec10 isLastSignalSell\cf6 \strokec6 )\cf4 \strokec4  \cf8 \strokec8 or\cf4 \strokec4  \cf6 \strokec6 (
\f1\b \cf8 \strokec8 isHeldLessThanFourBars
\f0\b0 \cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf10 \strokec10 isNewBuySignal\cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf10 \strokec10 isLastSignalSell\cf6 \strokec6 ))\cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf10 \strokec10 startShortTrade\cf6 \strokec6 [\cf11 \strokec11 4\cf6 \strokec6 ]\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 isDynamicExitValid\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf8 \strokec8 not\cf4 \strokec4  \cf10 \strokec10 useEmaFilter\cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf8 \strokec8 not\cf4 \strokec4  \cf10 \strokec10 useSmaFilter\cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf8 \strokec8 not\cf4 \strokec4  \cf10 \strokec10 useKernelSmoothing\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 endLongTrade\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 settings\cf4 \strokec4 .\cf10 \strokec10 useDynamicExits\cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf10 \strokec10 isDynamicExitValid\cf4 \strokec4  \cf8 \strokec8 ?\cf4 \strokec4  \cf10 \strokec10 endLongTradeDynamic\cf4 \strokec4  \cf8 \strokec8 :\cf4 \strokec4  \cf10 \strokec10 endLongTradeStrict\cf4 \strokec4  \cb1 \
\cf10 \cb3 \strokec10 endShortTrade\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 settings\cf4 \strokec4 .\cf10 \strokec10 useDynamicExits\cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf10 \strokec10 isDynamicExitValid\cf4 \strokec4  \cf8 \strokec8 ?\cf4 \strokec4  \cf10 \strokec10 endShortTradeDynamic\cf4 \strokec4  \cf8 \strokec8 :\cf4 \strokec4  \cf10 \strokec10 endShortTradeStrict\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf2 \cb3 \strokec2 // =========================\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // ==== Plotting Labels ====\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // =========================\cf4 \cb1 \strokec4 \
\
\cf2 \cb3 \strokec2 // Note: These will not repaint once the most recent bar has fully closed. By default, signals appear over the last closed bar; to override this behavior set offset=0.\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf5 \cb3 \strokec5 plotshape\cf6 \strokec6 (\cf10 \strokec10 startLongTrade\cf4 \strokec4  \cf8 \strokec8 ?\cf4 \strokec4  \cf9 \strokec9 low\cf4 \strokec4  \cf8 \strokec8 :\cf4 \strokec4  \cf9 \strokec9 na\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 'Buy'\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 shape.labelup\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 location.belowbar\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 color\cf8 \strokec8 =\cf12 \strokec12 ml.color_green\cf6 \strokec6 (\cf10 \strokec10 prediction\cf6 \strokec6 )\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 size\cf8 \strokec8 =\cf9 \strokec9 size.small\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 offset\cf8 \strokec8 =\cf11 \strokec11 0\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5 plotshape\cf6 \strokec6 (\cf10 \strokec10 startShortTrade\cf4 \strokec4  \cf8 \strokec8 ?\cf4 \strokec4  \cf9 \strokec9 high\cf4 \strokec4  \cf8 \strokec8 :\cf4 \strokec4  \cf9 \strokec9 na\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 'Sell'\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 shape.labeldown\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 location.abovebar\cf8 \strokec8 ,\cf4 \strokec4  \cf12 \strokec12 ml.color_red\cf6 \strokec6 (\cf8 \strokec8 -\cf10 \strokec10 prediction\cf6 \strokec6 )\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 size\cf8 \strokec8 =\cf9 \strokec9 size.small\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 offset\cf8 \strokec8 =\cf11 \strokec11 0\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5 plotshape\cf6 \strokec6 (\cf10 \strokec10 endLongTrade\cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf10 \strokec10 settings\cf4 \strokec4 .\cf10 \strokec10 showExits\cf4 \strokec4  \cf8 \strokec8 ?\cf4 \strokec4  \cf9 \strokec9 high\cf4 \strokec4  \cf8 \strokec8 :\cf4 \strokec4  \cf9 \strokec9 na\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 'StopBuy'\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 shape.xcross\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 location.absolute\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 color\cf8 \strokec8 =\cf9 \strokec9 #3AFF17\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 size\cf8 \strokec8 =\cf9 \strokec9 size.tiny\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 offset\cf8 \strokec8 =\cf11 \strokec11 0\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5 plotshape\cf6 \strokec6 (\cf10 \strokec10 endShortTrade\cf4 \strokec4  \cf8 \strokec8 and\cf4 \strokec4  \cf10 \strokec10 settings\cf4 \strokec4 .\cf10 \strokec10 showExits\cf4 \strokec4  \cf8 \strokec8 ?\cf4 \strokec4  \cf9 \strokec9 low\cf4 \strokec4  \cf8 \strokec8 :\cf4 \strokec4  \cf9 \strokec9 na\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 'StopSell'\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 shape.xcross\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 location.absolute\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 color\cf8 \strokec8 =\cf9 \strokec9 #FD1707\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 size\cf8 \strokec8 =\cf9 \strokec9 size.tiny\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 offset\cf8 \strokec8 =\cf11 \strokec11 0\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf2 \cb3 \strokec2 // ================\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // ==== Alerts ====\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // ================ \cf4 \cb1 \strokec4 \
\
\cf2 \cb3 \strokec2 // Separate Alerts for Entries and Exits\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf5 \cb3 \strokec5 alertcondition\cf6 \strokec6 (\cf10 \strokec10 startLongTrade\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 'Open Long \uc0\u9650 '\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 message\cf8 \strokec8 =\cf7 \strokec7 'LDC Open Long \uc0\u9650  | \{\{ticker\}\}@\{\{close\}\} | (\{\{interval\}\})'\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5 alertcondition\cf6 \strokec6 (\cf10 \strokec10 endLongTrade\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 'Close Long \uc0\u9650 '\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 message\cf8 \strokec8 =\cf7 \strokec7 'LDC Close Long \uc0\u9650  | \{\{ticker\}\}@\{\{close\}\} | (\{\{interval\}\})'\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5 alertcondition\cf6 \strokec6 (\cf10 \strokec10 startShortTrade\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 'Open Short \uc0\u9660 '\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 message\cf8 \strokec8 =\cf7 \strokec7 'LDC Open Short  | \{\{ticker\}\}@\{\{close\}\} | (\{\{interval\}\})'\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5 alertcondition\cf6 \strokec6 (\cf10 \strokec10 endShortTrade\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 'Close Short \uc0\u9660 '\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 message\cf8 \strokec8 =\cf7 \strokec7 'LDC Close Short \uc0\u9660  | \{\{ticker\}\}@\{\{close\}\} | (\{\{interval\}\})'\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf2 \cb3 \strokec2 // Combined Alerts for Entries and Exits\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf5 \cb3 \strokec5 alertcondition\cf6 \strokec6 (
\f1\b \cf8 \strokec8 startShortTrade
\f0\b0 \cf4 \strokec4  \cf8 \strokec8 or\cf4 \strokec4  \cf10 \strokec10 startLongTrade\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 'Open Position \uc0\u9650 \u9660 '\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 message\cf8 \strokec8 =\cf7 \strokec7 'LDC Open Position \uc0\u9650 \u9660  | \{\{ticker\}\}@\{\{close\}\} | (\{\{interval\}\})'\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5 alertcondition\cf6 \strokec6 (
\f1\b \cf8 \strokec8 endShortTrade
\f0\b0 \cf4 \strokec4  \cf8 \strokec8 or\cf4 \strokec4  \cf10 \strokec10 endLongTrade\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 'Close Position \uc0\u9650 \u9660 '\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 message\cf8 \strokec8 =\cf7 \strokec7 'LDC Close Position  \uc0\u9650 \u9660  | \{\{ticker\}\}@[\{\{close\}\}] | (\{\{interval\}\})'\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf2 \cb3 \strokec2 // Kernel Estimate Alerts\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf5 \cb3 \strokec5 alertcondition\cf6 \strokec6 (\cf10 \strokec10 condition\cf8 \strokec8 =\cf10 \strokec10 alertBullish\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 'Kernel Bullish Color Change'\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 message\cf8 \strokec8 =\cf7 \strokec7 'LDC Kernel Bullish \uc0\u9650  | \{\{ticker\}\}@\{\{close\}\} | (\{\{interval\}\})'\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5 alertcondition\cf6 \strokec6 (\cf10 \strokec10 condition\cf8 \strokec8 =\cf10 \strokec10 alertBearish\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 title\cf8 \strokec8 =\cf7 \strokec7 'Kernel Bearish Color Change'\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 message\cf8 \strokec8 =\cf7 \strokec7 'LDC Kernel Bearish \uc0\u9660  | \{\{ticker\}\}@\{\{close\}\} | (\{\{interval\}\})'\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf2 \cb3 \strokec2 // =========================\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // ==== Display Signals ==== \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // =========================\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf10 \cb3 \strokec10 atrSpaced\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 useAtrOffset\cf4 \strokec4  \cf8 \strokec8 ?\cf4 \strokec4  \cf5 \strokec5 ta.atr\cf6 \strokec6 (\cf11 \strokec11 1\cf6 \strokec6 )\cf4 \strokec4  \cf8 \strokec8 :\cf4 \strokec4  \cf9 \strokec9 na\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 compressionFactor\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 settings\cf4 \strokec4 .\cf10 \strokec10 neighborsCount\cf4 \strokec4  \cf8 \strokec8 /\cf4 \strokec4  \cf10 \strokec10 settings\cf4 \strokec4 .\cf10 \strokec10 colorCompression\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 c_pred\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 prediction\cf4 \strokec4  \cf8 \strokec8 >\cf4 \strokec4  \cf11 \strokec11 0\cf4 \strokec4  \cf8 \strokec8 ?\cf4 \strokec4  \cf5 \strokec5 color.from_gradient\cf6 \strokec6 (\cf10 \strokec10 prediction\cf8 \strokec8 ,\cf4 \strokec4  \cf11 \strokec11 0\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 compressionFactor\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 #787b86\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 #009988\cf6 \strokec6 )\cf4 \strokec4  \cf8 \strokec8 :\cf4 \strokec4  \cf10 \strokec10 prediction\cf4 \strokec4  \cf8 \strokec8 <=\cf4 \strokec4  \cf11 \strokec11 0\cf4 \strokec4  \cf8 \strokec8 ?\cf4 \strokec4  \cf5 \strokec5 color.from_gradient\cf6 \strokec6 (\cf10 \strokec10 prediction\cf8 \strokec8 ,\cf4 \strokec4  \cf8 \strokec8 -\cf10 \strokec10 compressionFactor\cf8 \strokec8 ,\cf4 \strokec4  \cf11 \strokec11 0\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 #CC3311\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 #787b86\cf6 \strokec6 )\cf4 \strokec4  \cf8 \strokec8 :\cf4 \strokec4  \cf9 \strokec9 na\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 c_label\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 showBarPredictions\cf4 \strokec4  \cf8 \strokec8 ?\cf4 \strokec4  \cf10 \strokec10 c_pred\cf4 \strokec4  \cf8 \strokec8 :\cf4 \strokec4  \cf9 \strokec9 na\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 c_bars\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 showBarColors\cf4 \strokec4  \cf8 \strokec8 ?\cf4 \strokec4  \cf5 \strokec5 color.new\cf6 \strokec6 (\cf10 \strokec10 c_pred\cf8 \strokec8 ,\cf4 \strokec4  \cf11 \strokec11 50\cf6 \strokec6 )\cf4 \strokec4  \cf8 \strokec8 :\cf4 \strokec4  \cf9 \strokec9 na\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 x_val\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf9 \strokec9 bar_index\cf4 \cb1 \strokec4 \
\cf10 \cb3 \strokec10 y_val\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf10 \strokec10 useAtrOffset\cf4 \strokec4  \cf8 \strokec8 ?\cf4 \strokec4  \cf10 \strokec10 prediction\cf4 \strokec4  \cf8 \strokec8 >\cf4 \strokec4  \cf11 \strokec11 0\cf4 \strokec4  \cf8 \strokec8 ?\cf4 \strokec4  \cf9 \strokec9 high\cf4 \strokec4  \cf8 \strokec8 +\cf4 \strokec4  \cf10 \strokec10 atrSpaced\cf8 \strokec8 :\cf4 \strokec4  \cf9 \strokec9 low\cf4 \strokec4  \cf8 \strokec8 -\cf4 \strokec4  \cf10 \strokec10 atrSpaced\cf4 \strokec4  \cf8 \strokec8 :\cf4 \strokec4  \cf10 \strokec10 prediction\cf4 \strokec4  \cf8 \strokec8 >\cf4 \strokec4  \cf11 \strokec11 0\cf4 \strokec4  \cf8 \strokec8 ?\cf4 \strokec4  \cf9 \strokec9 high\cf4 \strokec4  \cf8 \strokec8 +\cf4 \strokec4  \cf9 \strokec9 hl2\cf8 \strokec8 *\cf10 \strokec10 barPredictionsOffset\cf8 \strokec8 /\cf11 \strokec11 20\cf4 \strokec4  \cf8 \strokec8 :\cf4 \strokec4  \cf9 \strokec9 low\cf4 \strokec4  \cf8 \strokec8 -\cf4 \strokec4  \cf9 \strokec9 hl2\cf8 \strokec8 *\cf10 \strokec10 barPredictionsOffset\cf8 \strokec8 /\cf11 \strokec11 30\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf5 \cb3 \strokec5 label.new\cf6 \strokec6 (\cf10 \strokec10 x_val\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 y_val\cf8 \strokec8 ,\cf4 \strokec4  \cf5 \strokec5 str.tostring\cf6 \strokec6 (\cf10 \strokec10 prediction\cf6 \strokec6 )\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 xloc.bar_index\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 yloc.price\cf8 \strokec8 ,\cf4 \strokec4  \cf5 \strokec5 color.new\cf6 \strokec6 (\cf9 \strokec9 color.white\cf8 \strokec8 ,\cf4 \strokec4  \cf11 \strokec11 100\cf6 \strokec6 )\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 label.style_label_up\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 c_label\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 size.normal\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 text.align_left\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5 barcolor\cf6 \strokec6 (\cf10 \strokec10 showBarColors\cf4 \strokec4  \cf8 \strokec8 ?\cf4 \strokec4  \cf5 \strokec5 color.new\cf6 \strokec6 (\cf10 \strokec10 c_pred\cf8 \strokec8 ,\cf4 \strokec4  \cf11 \strokec11 50\cf6 \strokec6 )\cf4 \strokec4  \cf8 \strokec8 :\cf4 \strokec4  \cf9 \strokec9 na\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf2 \cb3 \strokec2 // ===================== \cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // ==== Backtesting ====\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // =====================\cf4 \cb1 \strokec4 \
\
\cf2 \cb3 \strokec2 // The following can be used to stream signals to a backtest adapter\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf10 \cb3 \strokec10 backTestStream\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf8 \strokec8 switch\cf4 \strokec4  \cb1 \
\pard\pardeftab720\sl360\partightenfactor0
\cf4 \cb3     \cf10 \strokec10 startLongTrade\cf4 \strokec4  \cf8 \strokec8 =>\cf4 \strokec4  \cf11 \strokec11 1\cf4 \cb1 \strokec4 \
\cb3     \cf10 \strokec10 endLongTrade\cf4 \strokec4  \cf8 \strokec8 =>\cf4 \strokec4  \cf11 \strokec11 2\cf4 \cb1 \strokec4 \
\cb3     \cf10 \strokec10 startShortTrade\cf4 \strokec4  \cf8 \strokec8 =>\cf4 \strokec4  \cf11 \strokec11 -1\cf4 \cb1 \strokec4 \
\cb3     \cf10 \strokec10 endShortTrade\cf4 \strokec4  \cf8 \strokec8 =>\cf4 \strokec4  \cf11 \strokec11 -2\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf5 \cb3 \strokec5 plot\cf6 \strokec6 (\cf10 \strokec10 backTestStream\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 "Backtest Stream"\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 display\cf8 \strokec8 =\cf9 \strokec9 display.none\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf2 \cb3 \strokec2 // The following can be used to display real-time trade stats. This can be a useful mechanism for obtaining real-time feedback during Feature Engineering. This does NOT replace the need to properly backtest.\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // Note: In this context, a "Stop-Loss" is defined instances where the ML Signal prematurely flips directions before an exit signal can be generated.\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf6 \cb3 \strokec6 [\cf10 \strokec10 totalWins\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 totalLosses\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 totalEarlySignalFlips\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 totalTrades\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tradeStatsHeader\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 winLossRatio\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 winRate\cf6 \strokec6 ]\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf12 \strokec12 ml.backtest\cf6 \strokec6 (\cf9 \strokec9 high\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 low\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 open\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 startLongTrade\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 endLongTrade\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 startShortTrade\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 endShortTrade\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 isEarlySignalFlip\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 maxBarsBackIndex\cf8 \strokec8 ,\cf4 \strokec4  \cf9 \strokec9 bar_index\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 settings\cf4 \strokec4 .\cf10 \strokec10 source\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 useWorstCase\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf13 \cb3 \strokec13 init_table\cf6 \strokec6 ()\cf4 \strokec4  \cf8 \strokec8 =>\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf4 \cb3     \cf10 \strokec10 c_transparent\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 color.new\cf6 \strokec6 (\cf9 \strokec9 color.black\cf8 \strokec8 ,\cf4 \strokec4  \cf11 \strokec11 100\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cb3     \cf5 \strokec5 table.new\cf6 \strokec6 (\cf9 \strokec9 position.top_right\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 columns\cf8 \strokec8 =\cf11 \strokec11 2\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 rows\cf8 \strokec8 =\cf11 \strokec11 7\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 frame_color\cf8 \strokec8 =\cf5 \strokec5 color.new\cf6 \strokec6 (\cf9 \strokec9 color.black\cf8 \strokec8 ,\cf4 \strokec4  \cf11 \strokec11 100\cf6 \strokec6 )\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 frame_width\cf8 \strokec8 =\cf11 \strokec11 1\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 border_width\cf8 \strokec8 =\cf11 \strokec11 1\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 border_color\cf8 \strokec8 =\cf10 \strokec10 c_transparent\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf13 \cb3 \strokec13 update_table\cf6 \strokec6 (\cf10 \strokec10 tbl\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tradeStatsHeader\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 totalTrades\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 totalWins\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 totalLosses\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 winLossRatio\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 winRate\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 stopLosses\cf6 \strokec6 )\cf4 \strokec4  \cf8 \strokec8 =>\cf4 \strokec4  \cb1 \
\pard\pardeftab720\sl360\partightenfactor0
\cf4 \cb3     \cf10 \strokec10 c_transparent\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf5 \strokec5 color.new\cf6 \strokec6 (\cf9 \strokec9 color.black\cf8 \strokec8 ,\cf4 \strokec4  \cf11 \strokec11 100\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cb3     \cf5 \strokec5 table.cell\cf6 \strokec6 (\cf10 \strokec10 tbl\cf8 \strokec8 ,\cf4 \strokec4  \cf11 \strokec11 0\cf8 \strokec8 ,\cf4 \strokec4  \cf11 \strokec11 0\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tradeStatsHeader\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 text_halign\cf8 \strokec8 =\cf9 \strokec9 text.align_center\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 text_color\cf8 \strokec8 =\cf9 \strokec9 color.gray\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 text_size\cf8 \strokec8 =\cf9 \strokec9 size.normal\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cb3     \cf5 \strokec5 table.cell\cf6 \strokec6 (\cf10 \strokec10 tbl\cf8 \strokec8 ,\cf4 \strokec4  \cf11 \strokec11 0\cf8 \strokec8 ,\cf4 \strokec4  \cf11 \strokec11 1\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 'Winrate'\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 text_halign\cf8 \strokec8 =\cf9 \strokec9 text.align_center\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 bgcolor\cf8 \strokec8 =\cf10 \strokec10 c_transparent\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 text_color\cf8 \strokec8 =\cf9 \strokec9 color.gray\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 text_size\cf8 \strokec8 =\cf9 \strokec9 size.normal\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cb3     \cf5 \strokec5 table.cell\cf6 \strokec6 (\cf10 \strokec10 tbl\cf8 \strokec8 ,\cf4 \strokec4  \cf11 \strokec11 1\cf8 \strokec8 ,\cf4 \strokec4  \cf11 \strokec11 1\cf8 \strokec8 ,\cf4 \strokec4  \cf5 \strokec5 str.tostring\cf6 \strokec6 (\cf10 \strokec10 totalWins\cf4 \strokec4  \cf8 \strokec8 /\cf4 \strokec4  \cf10 \strokec10 totalTrades\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 '#.#%'\cf6 \strokec6 )\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 text_halign\cf8 \strokec8 =\cf9 \strokec9 text.align_center\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 bgcolor\cf8 \strokec8 =\cf10 \strokec10 c_transparent\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 text_color\cf8 \strokec8 =\cf9 \strokec9 color.gray\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 text_size\cf8 \strokec8 =\cf9 \strokec9 size.normal\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cb3     \cf5 \strokec5 table.cell\cf6 \strokec6 (\cf10 \strokec10 tbl\cf8 \strokec8 ,\cf4 \strokec4  \cf11 \strokec11 0\cf8 \strokec8 ,\cf4 \strokec4  \cf11 \strokec11 2\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 'Trades'\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 text_halign\cf8 \strokec8 =\cf9 \strokec9 text.align_center\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 bgcolor\cf8 \strokec8 =\cf10 \strokec10 c_transparent\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 text_color\cf8 \strokec8 =\cf9 \strokec9 color.gray\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 text_size\cf8 \strokec8 =\cf9 \strokec9 size.normal\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cb3     \cf5 \strokec5 table.cell\cf6 \strokec6 (\cf10 \strokec10 tbl\cf8 \strokec8 ,\cf4 \strokec4  \cf11 \strokec11 1\cf8 \strokec8 ,\cf4 \strokec4  \cf11 \strokec11 2\cf8 \strokec8 ,\cf4 \strokec4  \cf5 \strokec5 str.tostring\cf6 \strokec6 (\cf10 \strokec10 totalTrades\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 '#'\cf6 \strokec6 )\cf4 \strokec4  \cf8 \strokec8 +\cf4 \strokec4  \cf7 \strokec7 ' ('\cf4 \strokec4  \cf8 \strokec8 +\cf4 \strokec4  \cf5 \strokec5 str.tostring\cf6 \strokec6 (\cf10 \strokec10 totalWins\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 '#'\cf6 \strokec6 )\cf4 \strokec4  \cf8 \strokec8 +\cf4 \strokec4  \cf7 \strokec7 '|'\cf4 \strokec4  \cf8 \strokec8 +\cf4 \strokec4  \cf5 \strokec5 str.tostring\cf6 \strokec6 (\cf10 \strokec10 totalLosses\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 '#'\cf6 \strokec6 )\cf4 \strokec4  \cf8 \strokec8 +\cf4 \strokec4  \cf7 \strokec7 ')'\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 text_halign\cf8 \strokec8 =\cf9 \strokec9 text.align_center\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 bgcolor\cf8 \strokec8 =\cf10 \strokec10 c_transparent\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 text_color\cf8 \strokec8 =\cf9 \strokec9 color.gray\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 text_size\cf8 \strokec8 =\cf9 \strokec9 size.normal\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cb3     \cf5 \strokec5 table.cell\cf6 \strokec6 (\cf10 \strokec10 tbl\cf8 \strokec8 ,\cf4 \strokec4  \cf11 \strokec11 0\cf8 \strokec8 ,\cf4 \strokec4  \cf11 \strokec11 5\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 'WL Ratio'\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 text_halign\cf8 \strokec8 =\cf9 \strokec9 text.align_center\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 bgcolor\cf8 \strokec8 =\cf10 \strokec10 c_transparent\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 text_color\cf8 \strokec8 =\cf9 \strokec9 color.gray\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 text_size\cf8 \strokec8 =\cf9 \strokec9 size.normal\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cb3     \cf5 \strokec5 table.cell\cf6 \strokec6 (\cf10 \strokec10 tbl\cf8 \strokec8 ,\cf4 \strokec4  \cf11 \strokec11 1\cf8 \strokec8 ,\cf4 \strokec4  \cf11 \strokec11 5\cf8 \strokec8 ,\cf4 \strokec4  \cf5 \strokec5 str.tostring\cf6 \strokec6 (\cf10 \strokec10 totalWins\cf4 \strokec4  \cf8 \strokec8 /\cf4 \strokec4  \cf10 \strokec10 totalLosses\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 '0.00'\cf6 \strokec6 )\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 text_halign\cf8 \strokec8 =\cf9 \strokec9 text.align_center\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 bgcolor\cf8 \strokec8 =\cf10 \strokec10 c_transparent\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 text_color\cf8 \strokec8 =\cf9 \strokec9 color.gray\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 text_size\cf8 \strokec8 =\cf9 \strokec9 size.normal\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cb3     \cf5 \strokec5 table.cell\cf6 \strokec6 (\cf10 \strokec10 tbl\cf8 \strokec8 ,\cf4 \strokec4  \cf11 \strokec11 0\cf8 \strokec8 ,\cf4 \strokec4  \cf11 \strokec11 6\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 'Early Signal Flips'\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 text_halign\cf8 \strokec8 =\cf9 \strokec9 text.align_center\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 bgcolor\cf8 \strokec8 =\cf10 \strokec10 c_transparent\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 text_color\cf8 \strokec8 =\cf9 \strokec9 color.gray\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 text_size\cf8 \strokec8 =\cf9 \strokec9 size.normal\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\cb3     \cf5 \strokec5 table.cell\cf6 \strokec6 (\cf10 \strokec10 tbl\cf8 \strokec8 ,\cf4 \strokec4  \cf11 \strokec11 1\cf8 \strokec8 ,\cf4 \strokec4  \cf11 \strokec11 6\cf8 \strokec8 ,\cf4 \strokec4  \cf5 \strokec5 str.tostring\cf6 \strokec6 (\cf10 \strokec10 totalEarlySignalFlips\cf8 \strokec8 ,\cf4 \strokec4  \cf7 \strokec7 '#'\cf6 \strokec6 )\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 text_halign\cf8 \strokec8 =\cf9 \strokec9 text.align_center\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 bgcolor\cf8 \strokec8 =\cf10 \strokec10 c_transparent\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 text_color\cf8 \strokec8 =\cf9 \strokec9 color.gray\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 text_size\cf8 \strokec8 =\cf9 \strokec9 size.normal\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\sl360\partightenfactor0
\cf8 \cb3 \strokec8 if\cf4 \strokec4  \cf10 \strokec10 showTradeStats\cf4 \cb1 \strokec4 \
\pard\pardeftab720\sl360\partightenfactor0
\cf4 \cb3     
\f1\b \cf8 \strokec8 var
\f0\b0 \cf4 \strokec4  \cf10 \strokec10 tbl\cf4 \strokec4  \cf8 \strokec8 =\cf4 \strokec4  \cf12 \strokec12 ml.init_table\cf6 \strokec6 ()\cf4 \cb1 \strokec4 \
\cb3     \cf8 \strokec8 if\cf4 \strokec4  \cf9 \strokec9 barstate.islast\cf4 \cb1 \strokec4 \
\cb3         \cf13 \strokec13 update_table\cf6 \strokec6 (\cf10 \strokec10 tbl\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 tradeStatsHeader\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 totalTrades\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 totalWins\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 totalLosses\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 winLossRatio\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 winRate\cf8 \strokec8 ,\cf4 \strokec4  \cf10 \strokec10 totalEarlySignalFlips\cf6 \strokec6 )\cf4 \cb1 \strokec4 \
}